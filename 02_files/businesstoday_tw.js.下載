/*! automatically generated; DO NOT CHANGE : 10:40:05 GMT+0800 (CST) !*/
var _pop=_pop||[];var _popIn5_config={};(function(){var o=function(x){var z=["https://www.businesstoday.com.tw/lazyweb/web/css/style_min.css","https://www.businesstoday.com.tw/lazyweb/web/css/fontawesome-all.css",];for(var v=0;v<z.length;v++){var y=document.createElement("link");y.rel="stylesheet";y.type="text/css";y.href=z[v];document.head.appendChild(y)}var i=x.container;var s=i.querySelectorAll("._popIn_recommend_article_ad ._popIn_recommend_art_media");for(f=0;f<s.length;f++){var A=s[f].textContent;s[f].innerHTML='<span class="_popIn_pr">PR</span>'+A}var w=i.querySelectorAll("._popIn_recommend_art_date");for(f=0;f<w.length;f++){var u=w[f].textContent;w[f].innerHTML='<i class="fa fa-calendar _popIn_date" aria-hidden="true"></i>'+u}};function t(i){i=i||30;return function(w){var x=new Date();var v=1000*60*60*24;var u=x.getTime()-i*v;x.setTime(u);var s=[x.getFullYear(),("00"+(x.getMonth()+1)).slice(-2),("00"+x.getDate()).slice(-2),"0000000000"].join("");return w.type==="ad"||w.pubdate===undefined||w.pubdate>=s}}var m={};m["collect.pc"]="#_popIn_recommend {         display : none ;     }     ._popIn_recommend_container {         display : none ;     } ";m["standard.pc"]='._popIn_recommend_container {         padding : 0px 0px 15px 0px ;         position : relative ;         clear : both ;         overflow : hidden ;     }     ._popIn_recommend_header {         color : #1A62AA ;         font-size : 1.4em ;         margin-bottom : 15px ;         display : none ;     }     ._popIn_recommend_articles {     }     ._popIn_recommend_article {         display : inline-block ;         vertical-align : top ;         padding : 20px 0 ;         border-bottom : 1px solid #ddd ;         border-bottom-length : 50px ;         width : -webkit-fill-available ;     }     ._popIn_recommend_art_img {         width : 80px ;         height : 60px ;         background : #f2f2f2 ;         position : relative ;         float : left ;     }     ._popIn_recommend_art_img a {         position : absolute ;         top : 0px ;         left : 0px ;         margin : 0px ;         width : 100% ;         height : 100% ;         display : inline-block ;         overflow : hidden ;         background-position : top center ;         background-size : cover ;         background-repeat : no-repeat ;         opacity : 0 ;         transition  : opacity 500ms ;         -moz-transition  : opacity 500ms ;         -o-transition  : opacity 500ms ;         -webkit-transition  : opacity 500ms ;     }     ._popIn_recommend_art_img a img {     }     ._popIn_recommend_art_title {         overflow : hidden ;         width : calc(100% - 80px) ;         padding-left : 10px ;     }     ._popIn_recommend_art_title a {         height : 2.7em ;         font-family : 微軟正黑體修正, 微軟正黑體, "Microsoft JhengHei", "LiHei Pro", "WenQuanYi Zen Hei", Arial ;         color : rgb(51, 51, 51) ;         font-size : 14px ;         font-weight : 400 ;         line-height : 1.35 ;         overflow : hidden ;     }     ._popIn_recommend_article:hover > ._popIn_recommend_art_title a {         text-decoration : underline ;     }     ._popIn_noimage a {         background : url(//api.popin.cc/images/noimg.png) no-repeat center ;     }     ._popIn_noimage a img {         display : none ;     }     ._popIn_recommend_art_category {         display : none ;     }     ._popIn_recommend_article_ad ._popIn_recommend_art_date {         display : none ;     }     ._popIn_recommend_art_date {         font-family : 微軟正黑體修正, 微軟正黑體, "Microsoft JhengHei", "LiHei Pro", "WenQuanYi Zen Hei", Arial ;         color : #999 ;         font-size : 14px ;         font-weight : 400 ;         line-height : 1 ;     }     ._popIn_date {         padding-left : 10px ;         margin-right : 5px ;     }     ._popIn_recommend_no_img {     }     ._popIn_pr {         top : 0 ;         width : inherit ;         white-space : nowrap ;         border : 1px solid #999 ;         color : #999 ;         text-align : center ;         font-size : 6px ;         padding : 0 3px ;         margin-right : 5px ;         font-family : 微軟正黑體修正, 微軟正黑體, "Microsoft JhengHei", "LiHei Pro", "WenQuanYi Zen Hei", Arial ;         margin-left : 8px ;     }     ._popIn_recommend_art_media {         font-family : 微軟正黑體修正, 微軟正黑體, "Microsoft JhengHei", "LiHei Pro", "WenQuanYi Zen Hei", Arial ;         color : #999 ;         font-size : 14px ;         font-weight : 400 ;         line-height : 1 ;     }     ._popIn_recommend_credit:hover {         opacity : 1 ;     }     ._popIn_recommend_credit {         position : absolute ;         right : 5px ;         font-size : 10px ;         opacity : 0.6 ;     }     ._popIn_recommend_credit_image {         display : inline-block ;         width : 40px ;         height : 10px ;         margin : 1px 0 0 4px ;         background-image : url(//api.popin.cc/images/logo.png) ;         background-repeat : no-repeat ;         background-position : 0px 0px ;         background-size : 40px 20px ;         vertical-align : text-top ;     }     ._popIn_recommend_container:hover ._popIn_recommend_credit_image {         background-position : 0px -10px ;     } ';m["iframe.pc"]='html body {         width : 100% ;         height : 100% ;     }     ._popIn_recommend_container {         padding : 0px 0px 15px 0px ;         position : relative ;         clear : both ;         overflow : hidden ;     }     ._popIn_recommend_header {         color : #1A62AA ;         font-size : 1.4em ;         margin-bottom : 15px ;         display : none ;     }     ._popIn_recommend_articles {     }     ._popIn_recommend_article {         display : inline-block ;         vertical-align : top ;         padding : 20px 0 ;         border-bottom : 1px solid #ddd ;         border-bottom-length : 50px ;         width : -webkit-fill-available ;     }     ._popIn_recommend_art_img {         width : 80px ;         height : 60px ;         background : #f2f2f2 ;         position : relative ;         float : left ;     }     ._popIn_recommend_art_img a {         position : absolute ;         top : 0px ;         left : 0px ;         margin : 0px ;         width : 100% ;         height : 100% ;         display : inline-block ;         overflow : hidden ;         background-position : top center ;         background-size : cover ;         background-repeat : no-repeat ;         opacity : 0 ;         transition  : opacity 500ms ;         -moz-transition  : opacity 500ms ;         -o-transition  : opacity 500ms ;         -webkit-transition  : opacity 500ms ;     }     ._popIn_recommend_art_img a img {     }     ._popIn_recommend_art_title {         overflow : hidden ;         padding-left : 10px ;         width : unset ;         display : flex ;     }     ._popIn_recommend_art_title a {         height : 2.7em ;         font-family : 微軟正黑體修正, 微軟正黑體, "Microsoft JhengHei", "LiHei Pro", "WenQuanYi Zen Hei", Arial ;         color : rgb(51, 51, 51) ;         font-size : 14px ;         font-weight : 400 ;         line-height : 1.35 ;         overflow : hidden ;         text-decoration : none ;     }     ._popIn_recommend_article:hover > ._popIn_recommend_art_title a {         text-decoration : none ;     }     ._popIn_noimage a {         background : url(//api.popin.cc/images/noimg.png) no-repeat center ;     }     ._popIn_noimage a img {         display : none ;     }     ._popIn_recommend_art_category {         display : none ;     }     ._popIn_recommend_article_ad ._popIn_recommend_art_date {         display : none ;     }     ._popIn_recommend_art_date {         font-family : 微軟正黑體修正, 微軟正黑體, "Microsoft JhengHei", "LiHei Pro", "WenQuanYi Zen Hei", Arial ;         color : #999 ;         font-size : 14px ;         font-weight : 400 ;         line-height : 1 ;         margin : 5px 0 0 ;     }     ._popIn_date {         padding-left : 10px ;         margin-right : 5px ;     }     ._popIn_date::before {         content : \'\\f133\' ;     }     ._popIn_recommend_no_img {     }     ._popIn_pr {         top : 0 ;         width : inherit ;         white-space : nowrap ;         border : 1px solid #999 ;         color : #999 ;         text-align : center ;         font-size : 6px ;         padding : 0 3px ;         margin-right : 5px ;         font-family : 微軟正黑體修正, 微軟正黑體, "Microsoft JhengHei", "LiHei Pro", "WenQuanYi Zen Hei", Arial ;         margin-left : 8px ;     }     ._popIn_recommend_art_media {         font-family : 微軟正黑體修正, 微軟正黑體, "Microsoft JhengHei", "LiHei Pro", "WenQuanYi Zen Hei", Arial ;         color : #999 ;         font-size : 14px ;         font-weight : 400 ;         line-height : 1 ;         margin : 5px 0 0 ;     }     ._popIn_recommend_credit:hover {         opacity : 1 ;     }     ._popIn_recommend_credit {         position : absolute ;         right : 5px ;         font-size : 10px ;         opacity : 0.6 ;     }     ._popIn_recommend_credit_image {         display : inline-block ;         width : 40px ;         height : 10px ;         margin : 1px 0 0 4px ;         background-image : url(//api.popin.cc/images/logo.png) ;         background-repeat : no-repeat ;         background-position : 0px 0px ;         background-size : 40px 20px ;         vertical-align : text-top ;     }     ._popIn_recommend_container:hover ._popIn_recommend_credit_image {         background-position : 0px -10px ;     } ';var p={};var q={};if(typeof q.all==="undefined"){q.all={}}q.all["Read"]={mainNodeElement:document.body};if(typeof q.pc==="undefined"){q.pc={}}q.pc["Discovery"]={adVideo:false,adEnable:true,load:"fast",agency:"bfm",templates:[{credit:"Recommended by",selector:"._popIn_recommend",position:"AfterBegin",title:"",css:m["collect.pc"],type:["rand","related",0]},{abtestName:"",channelId:"standard-pc",dateFormat:"Y-M-D",delWord:"",delImage:"",mediaFormat:"$MEDIA",plugins:["Imageback"],afterRender:o,css:m["standard.pc"],imageInView:true,imageSize:"160",position:"AfterBegin",selector:"._popIn_recommend",credit:"Recommended by",title:"今、あなたにオススメ",infiniteSize:6,infinitePages:1,type:["pattern",["rand","related",10],["left","ad",2],["left","cf",50],["rand","ad_reserved",1],["rand","pop","recommend","hot",100],function(){var y=[1];var u=["ad_reserved","ad","cf_img","hot_img","related_img","pop_img","recommend_img"];var x=[["cf_img","related_img","hot_img","pop_img","recommend_img"],["cf_img","related_img","hot_img","pop_img","recommend_img"],["cf_img","related_img","hot_img","pop_img","recommend_img"],["cf_img","related_img","hot_img","pop_img","recommend_img"],["ad","cf_img","related_img","hot_img","pop_img","recommend_img"]];if(y.length===0){u.shift();x.push(u)}for(var w=x.length-1;w>0;w--){var v=Math.floor(Math.random()*(w+1));var s=x[w];x[w]=x[v];x[v]=s}y.forEach(function(i){x.splice(i,0,u)});return x}],excludeRules:t(1095)}],apiUrlAdd:"&r_category=all&redirect=true",apiUrl:location.protocol+"//tw.popin.cc/popin_discovery/recommend?mode=new&ad=100&country=tw&url=%target"};if(typeof q.mobile==="undefined"){q.mobile={}}q.mobile["Discovery"]={adVideo:false,adEnable:true,load:"fast",agency:"bfm",templates:[{abtestName:"",channelId:"standard-mobile",adVideoPosition:1,dateFormat:"Y-M-D",delWord:"",delImage:"",afterRender:o,css:m["standard.pc"],imageSize:"160",imageInView:true,infiniteSize:6,infinitePages:1,plugins:["clickall","infinite"],position:"AfterBegin",selector:"._popIn_recommend",credit:"Recommended by",title:"今、あなたにオススメ",type:["pattern",["rand","related",10],["left","ad",2],["left","cf",50],["rand","ad_reserved",2],["rand","pop","recommend","hot",100],function(){var y=[1];var u=["ad_reserved","ad","cf_img","hot_img","related_img","pop_img","recommend_img"];var x=[["ad","cf_img","related_img","hot_img","pop_img","recommend_img"],["cf_img","related_img","hot_img","pop_img","recommend_img"],["cf_img","related_img","hot_img","pop_img","recommend_img"],["cf_img","related_img","hot_img","pop_img","recommend_img"],["cf_img","related_img","hot_img","pop_img","recommend_img"]];if(y.length===0){u.shift();x.push(u)}for(var w=x.length-1;w>0;w--){var v=Math.floor(Math.random()*(w+1));var s=x[w];x[w]=x[v];x[v]=s}y.forEach(function(i){x.splice(i,0,u)});return x}],mediaFormat:"$MEDIA",useCfRatio:0,excludeRules:t(1095)}],apiUrlAdd:"&r_category=all&redirect=true",apiUrl:location.protocol+"//tw.popin.cc/popin_discovery/recommend?mode=new&ad=100&country=tw&url=%target"};if(typeof q["pc-test"]==="undefined"){q["pc-test"]={}}q["pc-test"]["Discovery"]={adVideo:false,adEnable:true,load:"fast",agency:"bfm",templates:[{abtestName:"",channelId:"standard-pc",dateFormat:"Y-M-D",delWord:"",delImage:"",mediaFormat:"$MEDIA",plugins:["Imageback"],afterRender:o,css:m["iframe.pc"],imageInView:true,imageSize:"160",position:"AfterBegin",selector:"#_popIn_recommend",credit:"Recommended by",title:"今、あなたにオススメ",infiniteSize:6,infinitePages:1,type:["pattern",["rand","related",10],["left","ad",2],["left","cf",50],["rand","ad_reserved",0],["rand","pop","recommend","hot",100],function(){var y=[1];var u=["ad_reserved","cf_img","hot_img","related_img","pop_img","recommend_img"];var x=[["cf_img","related_img","hot_img","pop_img","recommend_img"],["cf_img","related_img","hot_img","pop_img","recommend_img"],["cf_img","related_img","hot_img","pop_img","recommend_img"],["cf_img","related_img","hot_img","pop_img","recommend_img"],["ad","cf_img","related_img","hot_img","pop_img","recommend_img"]];if(y.length===0){u.shift();x.push(u)}for(var w=x.length-1;w>0;w--){var v=Math.floor(Math.random()*(w+1));var s=x[w];x[w]=x[v];x[v]=s}y.forEach(function(i){x.splice(i,0,u)});return x}],excludeRules:t(1095)}],apiUrlAdd:"&r_category=all&redirect=true",apiUrl:location.protocol+"//tw.popin.cc/popin_discovery/recommend?mode=new&ad=100&country=tw&url=%target"};var k={pid:"businesstoday_tw",urlReplace:[{"[#].*":""}]};var h=1;h+=(location.href.indexOf("popinlib6=true")>-1?1:0);if(h>0){(function(w,z){if(void 0===z[w]){z[w]=function(){z[w].clients.push(this),this._init=[Array.prototype.slice.call(arguments)]},z[w].clients=[];for(var y=function(i){return function(){return this["_"+i]=this["_"+i]||[],this["_"+i].push(Array.prototype.slice.call(arguments)),this}},x=["addRecord","set","trackEvent","trackPageview","trackClicks","ready"],u=0;u<x.length;u++){var B=x[u];z[w].prototype[B]=y(B)}var A=document.createElement("script");A.type="text/javascript",A.async=!0,A.src=("https:"===document.location.protocol?"https:":"http:")+"//api.popin.cc/td_js_sdk_171.js";var v=document.getElementsByTagName("script")[0];v.parentNode.insertBefore(A,v)}})("Treasure2",window);(function(){try{if(typeof window.PopIn6!=="undefined"){return}var aa=(typeof window._popIn_ad_block_enable!=="undefined"&&window._popIn_ad_block_enable)?"i.popincdn.com":"api.popin.cc";var E={common:k};window.PopIn6={uid:"",_tempLog:[],log:function(av){this._tempLog.push(av)},event:{},protocol:(/^https:/.test(window.location.protocol)===true)?"https:":"http:",domain:aa,handleError:ao};window.popInGlobal=window.popInGlobal||{};if(typeof Array.prototype.forEach==="undefined"){return}if((typeof window.performance!=="undefined")&&(typeof window.performance.getEntries==="function")){PopIn6.__PERFORMANCE_DISCOVERY_INIT__=window.performance.now()}if(typeof Object.assign!="function"){(function(){Object.assign=function(az){if(az===undefined||az===null){throw new TypeError("Cannot convert undefined or null to object")}var aw=Object(az);for(var ax=1;ax<arguments.length;ax++){var ay=arguments[ax];if(ay!==undefined&&ay!==null){for(var av in ay){if(Object.prototype.hasOwnProperty.call(ay,av)){aw[av]=ay[av]}}}}return aw}})()}var ai=new Treasure2({writeKey:"8378/25839e06ce4cc1cab55c1c1f1e49d336d6d1d48f",database:"popin_ads"});ai.set("$global","td_global_id","td_global_id");ai.ready(function(){ai.trackValues=ai.getTrackValues()});window.PopIn6._logger=ai;ag(PopIn6.event);E._utils={ce:W,cio:A,inView:i,setPopInDomData:H,getPopInDomData:ar};function W(aw,av,az,ay){var ax=aw.appendChild(document.createElement(av));if(az){ax.setAttribute("class",az)}if(ay){ax.appendChild(document.createTextNode(ay))}return ax}function A(av,ax){av=av||"about:self";ax=ax||{};var ay=(typeof ax.pnode!=="undefined"&&typeof ax.pnode.nodeValue!=="undefined")?ax.pnode:document.body;var aw=W(ay,"iframe");aw.src=av;aw.setAttribute("scrolling","no");aw.setAttribute("frameBorder","0");aw.setAttribute("allowTransparency","true");(function(aA){aA.display="block";aA.width="0px";aA.height="0px";aA.margin="0px";aA.padding="0px";aA.overflow="none"})(aw.style);var az={element:aw,document:aw.contentDocument||aw.contentWindow.document,window:(aw.contentWindow)?aw.contentWindow:(aw.contentDocument.document)?aw.contentDocument.document:aw.contentDocument,write:function(aA){az.document.open();az.document.write(aA);az.document.close()}};return az}function z(av){var aw=av.getBoundingClientRect();return aw.top>0&&window.innerHeight-aw.top>0}var ad={valid:true};try{[["local",window.localStorage],["session",window.sessionStorage]].forEach(function(aw){var av={};var ax=aw[1];ad[aw[0]]=av;ad.valid=ad.valid&&!!ax.getItem;av.get=function(ay){return ax.getItem(ay)};av.set=function(ay,az){ax.setItem(ay,az)};av.remove=function(ay){ax.removeItem(ay)}})}catch(ap){ad.valid=false}function i(){if("function"===typeof window.IntersectionObserver){y.apply(this,arguments)}else{v.apply(this,arguments)}}var P=[];var K=false;function v(aw,ax){var av=function(){if(z(aw)){ax();return true}return false};if(!av()){P.push(av)}if(w(P)&&K===false){K=setInterval(function(){if(P.length>0){for(var az=P.length;az--;){var ay=P[az]();if(ay){P.splice(az,1)}}}if(P.length===0){clearInterval(K);K=false}},100)}}var au;var L={};var ah=0;function y(aw,ax){if(!au){au=new IntersectionObserver(function(ay){ay.forEach(function(aB){if(aB.isIntersecting){var az=aB.target.__popIn_inview_handler_key__;var aA=L[az];"function"===typeof aA&&aA();delete L[az];delete aB.target.__popIn_inview_handler_key__;au.unobserve(aB.target)}})},{rootMargin:"0px"})}var av=""+ah++;aw.__popIn_inview_handler_key__=av;L[av]=ax;au.observe(aw)}function w(av){return typeof av!=="undefined"&&av!==""&&av!==0&&av!==false&&av!==null}function F(ax,aw){if(!w(ax)||!w(aw)){return ax}var av=ax;aw.forEach(function(az){var ay=Object.keys(az);ay.forEach(function(aA){av=av.replace(new RegExp(aA),az[aA])})});return av}var s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!$";function af(az){var ay=0,aB="",ax="";for(var aw=0,aA=az.length;aw<aA;aw++){ax=az.charCodeAt(aw);ay=((ay<<5)-ay)+ax;ay|=0}for(var av=0;av<6;av++){aB+=s.charAt(ay&63);ay>>>=6}return aB}function ae(ay){var ax=ay.length,aw,av;while(0!==ax){av=Math.floor(Math.random()*ax);ax-=1;aw=ay[ax];ay[ax]=ay[av];ay[av]=aw}return ay}function G(av,ay){var az="_p6_"+(Date.now()*100+Math.round(Math.random()*100)).toString(16);window[az]=function(aA){try{ay(aA);delete window[az]}catch(aB){ao(aB)}};var ax=document.createElement("script");ax.type="text/javascript";ax.charset="utf-8";ax.async=true;ax.src=av+"&callback="+az;var aw=document.getElementsByTagName("script")[0];aw.parentNode.insertBefore(ax,aw)}function M(){var av=navigator.userAgent;return[/(tablet|ipad|playbook|silk)|(?!.*android.?_).*(?=android(?!.*mobile))/i].some(function(aw){return(av.match(aw))})?"tablet":[/Android/i,/webOS/i,/iPhone/i,/iPod/i,/BlackBerry/i,/Windows Phone/i].some(function(aw){return(av.match(aw))})?"mobile":"pc"}function D(){var av=window.navigator.userAgent;switch(true){case /Android/.test(av):return"Android";case /iPhone|iPad|iPod/.test(av):return"iOS";case /Windows/.test(av):return"Windows";case /Mac OS X/.test(av):return"Mac"}return"other"}function ak(aw,av){try{return al(aw.split(av)[1].trim().split(/[^\w\.]/)[0])}catch(ax){}return"0.0.0"}function al(av){var aw=av.split(/[\._]/);return(parseInt(aw[0],10)||0)+"."+(parseInt(aw[1],10)||0)+"."+(parseInt(aw[2],10)||0)}function X(av,aw){switch(aw){case"Android":return ak(av,"Android");case"iOS":return ak(av,/OS /);case"Windows":return ak(av,/Phone/.test(av)?/Windows Phone (?:OS )?/:/Windows NT/);case"Mac":return ak(av,/Mac OS X /)}return"0.0.0"}function Q(av){switch(true){case /CriOS/.test(av):return"Chrome for iOS";case /Edge/.test(av):return"Edge";case /Chrome/.test(av):return"Chrome";case /Firefox/.test(av):return"Firefox";case /Android/.test(av):return"AOSP";case /MSIE|Trident/.test(av):return"IE";case /Safari\//.test(av):return"Safari";case /AppleWebKit/.test(av):return"WebKit";case /Vivaldi/.test(av):return"Vivaldi"}return""}function ab(aw,av){switch(av){case"Chrome for iOS":return ak(aw,"CriOS/");case"Edge":return ak(aw,"Edge/");case"Chrome":return ak(aw,"Chrome/");case"Firefox":return ak(aw,"Firefox/");case"Vivaldi":return ak(aw,"Vivaldi/");case"AOSP":return ak(aw,/Silk/.test(aw)?"Silk/":"Version/");case"IE":return/IEMobile/.test(aw)?ak(aw,"IEMobile/"):/MSIE/.test(aw)?ak(aw,"MSIE "):ak(aw,"rv:");case"Safari":return ak(aw,"Version/");case"Webkit":return ak(aw,"WebKit/")}return""}function am(){var av=window.screen;return av?[av.width,av.height].join("x"):"-"}function R(){var ax=document.documentElement&&document.documentElement.clientHeight;var aA=document.documentElement&&document.documentElement.clientWidth;var az=window.innerHeight;var aw=window.innerWidth;var av=ax<az?az:ax;var ay=aA<aw?aw:aA;return ay+"x"+av}function C(){var az=window.navigator;var aw=az.userAgent;var ay=D(aw);var aA=X(aw,ay);var av=Q(aw);var ax=ab(aw,av);return{os:ay,os_version:aA,browser:av,browser_version:ax,screen:am(),viewport:R(),user_agent:window.navigator.userAgent,referrer:document.referrer,path:location.pathname,charset:(document.characterSet||document.charset||"-").toLowerCase(),language:az&&(az.language||(az.language||az.browserLanguage)||"-").toLowerCase(),color:window.screen?window.screen.colorDepth+"-bit":"-",title:document.title,url:document.location.href.split("#")[0],platform:window.navigator.platform,host:document.location.host}}var at=C();function J(ax){var ay=ax.split(".");var av=[];for(var aw=ay.pop();ay.length>0;aw=ay.pop()){if(aw==="www"){break}av.push(aw);if(aw.length>3&&av.length>0){break}}return av.reverse().join(".")}function Z(av){var aw={};if(av.indexOf("?")>0){qString=av.substring(av.indexOf("?"));av=av.substring(0,av.indexOf("?"));qString.replace(new RegExp("([^?=&]+)(=([^&]*))?","g"),function(ay,ax,aA,az){aw[ax]=az})}return{url:av,qString:aw}}function ac(ax){var aw=/^(?:([^:\/?#]+):)?(?:\/\/([^\/?#]*))?([^?#]*)(?:\?([^#]*))?(?:#(.*))?/;var av=ax.match(aw);if(av){return{scheme:av[1],host:av[2],path:av[3],query:av[4],fragment:av[5]}}else{return null}}function ag(av){av._listeners={};av.addEventListener=function(aw,ax){if(!this._listeners[aw]){this._listeners[aw]=[]}this._listeners[aw].push(ax)};av.fireEvent=function(ay,ax){var aw=this;var az=aw._listeners[ay];if(!Array.isArray(ax)){ax=[ax]}ax.push(E);if(w(az)){az.forEach(function(aA){aA.apply(aw,ax)})}};av.addEventListenerFromEventMap=function(aA){if(!aA){return}var az;for(var ax in aA){if(!aA.hasOwnProperty(ax)){continue}az=aA[ax];if(!Array.isArray(az)){az=[az]}for(var aw=0,ay;ay=az[aw];aw++){"function"===typeof ay&&av.addEventListener(ax,ay)}}};window.PopInGlobal=window.PopInGlobal||{};av.addEventListenerFromEventMap(k.customEvents);av.addEventListenerFromEventMap(window.PopInGlobal.customEvents)}function u(ax){var aw=[];aw.push('<body style="margin:0px;padding:0px;background-color: transparent;">');aw.push("<script>window.inDapIF = true;<\/script>");aw.push(ax);aw.push("</body>");var av=A("about:self");av.write(aw.join(""))}function ao(aA){if(!window.Treasure2){setTimeout(function(){ao.apply(this,arguments)},500);return}var ax=new window.Treasure2({writeKey:"8378/25839e06ce4cc1cab55c1c1f1e49d336d6d1d48f",database:"fe_monitor"});var aw=aq||{};var av=V||{};var aB={msg:aA.message||"",stack:aA.stack||"",name:aA.name||"",ua:navigator.userAgent,api_host:aw.apiHost||"",device:M(),media:aw.media||"",url:aw.target||"",logid:av.logid||"",piuid:S?S.getUid():""};var az=PopIn6._logger.trackValues||{};for(var ay in az){aB[ay]=az[ay]}ax.addRecord("err_log",aB);throw aA}window.PopIn6.handleError=ao;var an=[];var Y="__popIn_dom_key__";function ar(ay,aw){if(!ay){return{}}var av=+ay[Y];if("number"!==typeof av||av===NaN){return null}var ax=an[av]||null;return"string"===typeof aw?ax[aw]:ax}function H(az,aw,ay){if(!az){return null}var av=az[Y]||"";var ax={};if(av===""){av=an.length;az[Y]=av}else{av=+av;ax=an[av]||{}}if(typeof aw==="string"){ax[aw]=ay}else{if(Object.prototype.toString.call(aw)==="[object Object]"){ax=Object.assign(ax,aw)}}an[av]=ax;return ax}var I={};I.Class=function(ax,aw,ay){var av=this[ax]=function(){if(this.init){this.init.apply(this,arguments)}};av.prototype=aw;if(ay&&Object.prototype.toString.call(ay)==="[object Object]"){Object.assign(av,ay)}};E.Discovery6=I;I.Class("ArticleItem",{init:function(aG,aD){for(var ay in aG){this[ay]=aG[ay]}var aw="";var aC="";var aF=window.PopIn6.protocol;var aB=aD.imageSize;var ax=aD.notFoundImg;var aH="";this.ad=aG.type.indexOf("ad")===0;this.reserved=aG.type.indexOf("reserved")>0;if(this.ad){var av=["api_host="+aq.apiHost,"piuid="+S.getUid()];if(w(V.logid)){av.push("logid="+V.logid)}var aA=[];if(w(aD.channelId)){aA.push("m_ch_"+aD.channelId)}if(w(V.channel)&&Array.isArray(V.channel)){aA.push.apply(aA,V.channel.map(function(aI){return"m_"+aI}))}if(aA.length>0){av.push("extra="+aA.join("%7C"))}this.url+=((/\?/.test(this.url)===true)?"&":"?")+av.join("&");aC=aG.image;if(w(aB)&&(""+aB).indexOf("w")===0){aw=aF+"//f.popincdn.com/"+aB+"/";aH=aw+aC}else{aw=aF;aH=aC.indexOf("http://images.popin.cc")>0?aw+aC.replace(/http:\/\/images.popin.cc/,"//i.popincdn.com"):aC;if(aw==="https:"&&aH.indexOf("http://images.popin.cc")>-1){aH=aH.replace(/http:\/\/images.popin.cc/,"https://i.popincdn.com")}}aH=aH.replace(/i.popincdn.com/,"imageaws.popin.cc");this._setTrackingPixelConfig(aG);if(aG.imp){this.originalImp=aG.imp;this.imp=aG.imp+((/\?/.test(aG.imp)===true)?"&":"?")+av.join("&")}if(aG.dsp){var aE=new I.Dsp(aG.dsp);if(aE.setup(this,{addParameters:av})){this.dspObj=aE}}}else{if(w(aB)&&(""+aB).indexOf("w")===0){aC=aG.image_url||"";aw=aF+"//f.popincdn.com/"+aB+"/";aH=aw+aC}else{if(w(aB)&&(""+aB)==="original"){aC=aG.image_url||"";aH=aC}else{aC=aG.image||"";if(aC==="noimage"||!w(aC)){aC=""}else{aw=aC.indexOf("http")>-1?"":"https://i.popincdn.com/article/";aH=aw+((aB===""||aC.indexOf("http")>-1)?aC:aC.replace(".","_"+aB+"."))}}}aH=aH.replace(/i.popincdn.com/,"imageaws.popin.cc")}this.image=w(aC)?aH:ax;var az=Z(this.url);this.token=az.qString.token;this.uid=az.qString.uid},_formatTrackingPixelMacroCode:function(aB,ay){var aA=aB;var av={"{{p_advid}}":ay.userid,"{{p_campId}}":ay.campaign,"{{p_sid}}":aq.media,"{{p_adid}}":ay.nid};for(var aw in av){var ax=new RegExp(aw,"g"),az=av[aw];aA=aA.replace(ax,az)}return aA},_setTrackingPixelConfig:function(ax){if(w(ax.click_tracking_pixel)){this.click_tracking_pixel=this._formatTrackingPixelMacroCode(ax.click_tracking_pixel,ax)}if(w(ax.tracking_pixel)){this.tracking_pixel=this._formatTrackingPixelMacroCode(ax.tracking_pixel,ax);var av=this._getCustomTrackingPixelConf(this.tracking_pixel);if(av){if(av.name==="ias"){var ay="&ias_adpath=%23",aw=/((https?:)?\/\/\w+\.adsafeprotected.com\/(?!.*ias_adpath.*)([\w-./?%&=]*)?)/g,az,aA;az=ax.campaign+ax.nid+new Date().getTime();aA=btoa(af(az));this.trackingPixelConf={};this.trackingPixelConf.name=av.name;this.trackingPixelConf.trackingNodeId=aA;this.tracking_pixel=this.tracking_pixel.replace(aw,"$1"+ay+aA)}}}},_getCustomTrackingPixelConf:function(az){var ay=[{name:"ias",check_reg:/https?:\/\/\w+.adsafeprotected.com\//}],ax;for(var aw=0,av=ay.length;aw<av;aw++){ax=ay[aw];if(ax.check_reg&&ax.check_reg.test(az)){return ax}}}});I.Class("ArticleRenderer",{init:function(av,ax,aw){this.article=ax;this.articleDiv=av;this.template=aw;this.ad=ax.type.indexOf("ad")===0;this.render(w(aw.channelId)?aw.channelId:false)},render:function(az){var aL=this.article,av=this.articleDiv,aJ=this.template;av.classList.add("_popIn_recommend_article_"+aL.type);if(aJ.isFullClick){av.setAttribute("href",aL.url)}if(aL.type2.indexOf("_noimg")>-1){av.classList.add("_popIn_recommend_no_img")}else{av.classList.add("_popIn_recommend_has_img")}if(aL.trackingPixelConf&&aL.trackingPixelConf.trackingNodeId){av.id=aL.trackingPixelConf.trackingNodeId}var aH=W(av,"div","_popIn_recommend_art_img");var ay=W(aH,"a");ay.href=aL.url;ay.style.opacity=1;var aI=function(){ay.style.backgroundImage="url("+aL.image+")"};if(aJ.imageInView){i(ay,aI)}else{aI()}var aw=W(av,"div","_popIn_recommend_art_title");var aG=W(aw,"a",false,aL.title);aG.href=aL.url;var aC=W(av,"div","_popIn_recommend_art_category",aL.category);if(aL.media){var aE=W(av,"div","_popIn_recommend_art_media",aJ.mediaFormat.replace("$MEDIA",aL.media))}var aF=W(av,"div","_popIn_recommend_art_date",aL.formattedDate);if(aL.author_name){var aB=W(av,"div","_popIn_recommend_art_author",aL.author_name)}var ax=Array.apply(null,av.querySelectorAll("a")),aK=(aJ.isTargetTop===true)?"_top":(aJ.addTargetBlank===true)?"_blank":null;if(av.nodeName==="A"){ax.push(av)}for(var aA=0,aD=ax.length;aA<aD;aA++){this._editLinkNode(ax[aA],az,aK)}},_editLinkNode:function(av,aw,ax){if(this.ad){this._editAdLinkNode(av,ax)}if(ax!==null){av.target=ax}av.addEventListener("click",this._onClick.bind(this,aw),false)},_editAdLinkNode:function(aw,ax){aw.href=this._replacePopInFlagInAdLink(aw.href);aw.target=(ax===null)?"_blank":ax;aw.setAttribute("rel","nofollow");var av="&mode=20170420&referer_type="+x;if(typeof PopIn6._logger.trackValues!=="undefined"){av+="&td_client_id="+PopIn6._logger.trackValues.td_client_id}aw.href+=av},_replacePopInFlagInAdLink:function(aw){if(aw.indexOf("popIn_flag_")===-1){return aw}var av={"${popIn_flag_media_host}":location.host,"${popIn_flag_os}":D(),"${popIn_flag_timestamp}":T};return aw.replace(/\blp=.+?&/,function(ay){for(var ax in av){ay=ay.replace(new RegExp(encodeURIComponent(ax),"g"),av[ax])}return ay})},_onClick:function(az,ay){var aA=ay.currentTarget;ay.preventDefault();ay.stopPropagation();var aw=this.article,av=(aA.target==="_blank"),ax=aA.href;if(/^ad/.test(aw.type)===true){this._onClickAd(ax,aw,az,av)}else{this._onClickArticle(ax,aw,az,av)}},_writeArticleClickHistory:function(aw){if(ad.valid===false){return}var az="_popIn_article_click_history";var ay=ad.local,ax=ay.get(az),aA=(ax===null)?[]:JSON.parse(ax),av=aA.filter(this._isNotSameHistoryURL.bind(this,aw));av.push({url:aw,timestamp:Date.now()});ay.set(az,JSON.stringify(av))},_isNotSameHistoryURL:function(av,aw){return(aw.url!==av)},_onClickArticle:function(ax,aw,az,av){var ay=aw.type;ad.valid&&ad.session.set("_pi_article_recommend_type",ay);this._writeArticleClickHistory(ax);var aA;if(av){this._openNewTab(ax)}else{aA=this._movePage.bind(null,ax)}I.Log.articleClickLog(aw,aA,{channelId:az});if(typeof aA==="function"){setTimeout(aA,200)}},_onClickAd:function(ax,aw,ay,av){I.Log.adClickLog(aw,{channelId:ay});if(w(aw.click_tracking_pixel)){u(aw.click_tracking_pixel)}if(aw.dspObj){aw.dspObj.execDspFunc("click",aw)}if(av){this._openNewTab(ax)}else{this._movePage(ax)}},_movePage:function(av){window.top.location.href=av},_openNewTab:function(av){window.open(av,"_blank")}});I.Class("ArticleStyleMonitor",{styleFlagEnum:{UNKNOW:"0",ERROR:"_",STYLE_1:"1",STYLE_2:"2",STYLE_3:"3",STYLE_4:"4",STYLE_5:"5",STYLE_6:"6"},checkList:["checkStyle1","checkStyle2","checkStyle3","checkStyle4","checkStyle5","checkStyle6"],init:function(av){this.articleNode=av;this.styleFlag=""},initAttribute:function(){this.articleRect=this.articleNode.getBoundingClientRect();this.parentNode=this.articleNode.parentNode;this.parentRect=this.parentNode.getBoundingClientRect();this.imageNode=this.articleNode.querySelector("._popIn_recommend_art_img");this.imageRect=this.imageNode.getBoundingClientRect();var av=this.articleNode.querySelector("._popIn_recommend_art_title");this.titleNode=av.children[0]||av;this.titleRect=this.titleNode.getBoundingClientRect()},getStyleFlag:function(){try{if(this.styleFlag){return this.styleFlag}this.initAttribute();var av;for(var ax=0,aw;aw=this.checkList[ax++];){if("function"!==typeof this[aw]){continue}av=this[aw]();if(av){return(this.styleFlag=av)}}}catch(ay){return(this.styleFlag=this.styleFlagEnum.ERROR)}return(this.styleFlag=this.styleFlagEnum.UNKNOW)},checkStyle1:function(){if(this.imageRect.width===0&&this.imageRect.height===0){return this.styleFlagEnum.STYLE_1}},checkStyle2:function(){if(this.titleRect.top>=this.imageRect.bottom&&(this.articleRect.width/this.parentRect.width)>=0.9){return this.styleFlagEnum.STYLE_2}},checkStyle3:function(){if(this.titleRect.top>=this.imageRect.bottom){return this.styleFlagEnum.STYLE_3}},checkStyle4:function(){if(this.imageRect.right<=this.titleRect.left){return this.styleFlagEnum.STYLE_4}},checkStyle5:function(){if(this.titleRect.right<=this.imageRect.left){return this.styleFlagEnum.STYLE_5}},checkStyle6:function(){if(this.titleRect.top>this.imageRect.top&&this.titleRect.right>this.imageRect.left&&this.titleRect.bottom<=this.imageRect.bottom&&this.titleRect.left<this.imageRect.right){return this.styleFlagEnum.STYLE_6}}});var aj=[];I.Class("ArticlesSelector",{init:function(aw){this.template=aw;this.type=aw.type;this.useCf=false;this.includeRules=[].concat(aw.includeRules);this.excludeRules=[].concat(aw.excludeRules);if(aw.isClickHistory){this.processCookie(V.cookie)}if(aw.hideHistory===true){var av=ad.local.get("_popIn_article_click_history");this._articleClickHistories=av===null?[]:JSON.parse(av);this._articleExpiredTime=Date.now()-(aw.articleNoDisplayPeriod*(24*60*60*1000));this.excludeRules.push(this._canShowArticle.bind(this))}},_canShowArticle:function(av){if(/^ad/.test(av.type)===true){return true}return this._articleClickHistories.every(this._isValidPeriodArticle.bind(this,av.url,this._articleExpiredTime))},_isValidPeriodArticle:function(aw,av,ax){return(this._isInvalidPeriodArticle(aw,av,ax)===false)},_isInvalidPeriodArticle:function(aw,av,ax){return(ax.url===aw)&&(ax.timestamp>=av)},getData:function(){this.isCfRatio();var av=this.process(this.type);var aw=this.template.infiniteSize*this.template.infinitePages;return w(av)?av.slice(0,Math.min(aw,av.length)):[]},isCfRatio:function(){var aA=this.template.useCfRatio||k.useCfRatio;if(!aA){return}var av=ad.valid&&ad.session.get("_pi_cf_abtest_key_"+this.template.channelId);if(av){this.useCf="with_cf"===av?true:false}else{if(Math.random()<=+aA){ad.session.set("_pi_cf_abtest_key_"+this.template.channelId,"with_cf");this.useCf=true}else{ad.session.set("_pi_cf_abtest_key_"+this.template.channelId,"without_cf")}}if(this.useCf){var az=this.type;var aC=false;for(var ay=0,ax=az.length;ay<ax;ay++){var aw=az[ay];var aB="";if(typeof aw=="string"){aB="+"+aw+"+"}if(Array.isArray(aw)){aB="+"+aw.join("+")+"+"}if(/\+cf\+/.test(aB)){aC=true;break}}if(!aC){this.type.splice(1,0,["left","cf",50])}}},deleteDuplicates:function(az){var ax={};var aw=[];function av(aE){for(var aC=0;aC<aE.length;aC++){var aD=aC+"_"+aE[aC];if(ax[aD]){return false}else{ax[aD]=1}}return true}aj.forEach(av);for(var ay=0;ay<az.length;ay++){var aB=az[ay];var aA=av(aB.hashData);if(aA){aw.push(aB)}}return aw},processArticle:function(aw,av){var ax=av.indexOf("ad")>-1;if(w(aw.title)&&w(this.template.delWord)&&!ax){aw.title=aw.title.replace(new RegExp(this.template.delWord,"g"),"")}if(w(aw.title)){aw.title=aw.title.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&amp;/g,"&")}if(!w(aw.title)){return false}if(aw.url===aq.target){return false}if(aw.pureUrl===void 0){aw.pureUrl=aw.url}if(!ax){aw.url=w(this.template.displayUrlReplace)?F(aw.url,this.template.displayUrlReplace):aw.url;aw.url+=(w(this.template.addQuery)?(((/[?]/.test(aw.url))?"&":"?")+this.template.addQuery):"")}aw.originalUrl=aw.url.indexOf("?url=")>0?decodeURIComponent(Z(aw.url).qString.url):aw.url;if((this.template.delImage&&aw.image.indexOf(this.template.delImage)>=0)||(aw.image==="noimage")){aw.image=""}aw.type=av;aw.type2=av+(aw.image?"_img":"_noimg");aw.hashData=[af(aw.title),af(aw.originalUrl)];aw.formattedDate=(w(aw.pubdate)&&aw.pubdate!=="000000000000000000")?this.formatDate(aw.pubdate):"";if(!this.isValid(aw)){return false}return aw},formatDate:function(aw){var av=this.template.dateFormat;if(aw.slice(8,12)==="0000"&&/h|m|s/.test(av)){av=av.replace(/h|m|s|:|：|\s|時|分|秒/g,"")}var ax={Y:[0,4],M:[4,6],D:[6,8],h:[8,10],m:[10,12],s:[12,14]};Object.keys(ax).forEach(function(az){var ay=Number(String.prototype.slice.apply(aw,ax[az]));if(/m|s/.test(az)&&ay<10){ay="0"+ay}av=av.replace(new RegExp(az),ay)});return av},isValid:function(ay){for(var ax=0,aB=this.excludeRules.length;ax<aB;ax++){var aA=this.excludeRules[ax];if(!aA(ay)){return false}}for(var aw=0,av=this.includeRules.length;aw<av;aw++){var az=this.includeRules[aw];if(az(ay)){return true}}return true},getArticlesByType:function(ay){var ax=V[ay];var av=[];for(var aw=0;aw<ax.length;aw++){var aA=Object.assign({},ax[aw]);var az=this.processArticle(aA,ay);if(az){av.push(az)}}return av},process:function(av){if(typeof av==="string"&&V[av]){return this.template.forceProcess?this.deleteDuplicatesDsp(this.getArticlesByType(av)):this.deleteDuplicates(this.getArticlesByType(av))}if(Array.isArray(av)){var aw=av[0];if(typeof this[aw]==="function"){return this.template.forceProcess?this.deleteDuplicatesDsp(this[aw](av)):this.deleteDuplicates(this[aw](av))}}return[]},getMiddle:function(ax){var aw=[];for(var av=1;av<ax.length-1;av++){aw=aw.concat(this.process(ax[av]))}return aw},rand:function(ax){var av=ax[ax.length-1];var aw=ae(this.getMiddle(ax));return aw.slice(0,Math.min(av,aw.length))},left:function(ax){var av=ax[ax.length-1];var aw=this.getMiddle(ax);return aw.slice(0,Math.min(av,aw.length))},right:function(ax){var av=ax[ax.length-1];var aw=this.getMiddle(ax);return aw.slice(Math.max(0,aw.length-av),aw.length).reverse()},pattern:function(aw){var aA=aw[aw.length-1];var ax=this.getMiddle(aw);var aL=[];var aK=[].concat(ax);var az=true;while(az){az=false;var ay=aA;while(typeof ay==="function"){ay=ay()}if(ay.length>0&&this.useCf){for(var aI=0,aC=ay.length;aI<aC;aI++){var aF=ay[aI];if(Array.isArray(aF)){if(aF[0]=="ad"||/^ad_/.test(aF[0])){ay[aI].splice(1,0,"cf_img")}else{if(aF[0]!="cf_img"){ay[aI].splice(0,0,"cf_img")}}}else{if(aF=="ad"||/^ad_/.test(aF)){ay.splice(aI,1,[aF,"cf_img"])}else{if(aF!="cf_img"){ay.splice(aI,1,["cf_img",aF])}}}}}for(var aI=0,av=ay.length;aI<av;aI++){var aE=ay[aI];aE=Array.isArray(aE)?aE:[aE];loop:for(var aH=0,aD=aE.length;aH<aD;aH++){var aB=aE[aH];for(var aG=0,aJ=aK.length;aG<aJ;aG++){var aM=aK[aG];if(aM.type2.search(aB)>-1){az=true;aL.push(aM);aK.splice(aG,1);break loop}}}}}return aL},processCookie:function(aw){var ay=aw._click;if(!w(ay)){return}var ax={};var az=ay.split("|");var av=Date.now();az.forEach(function(aA){var aB=aA.split(".");var aD=aB[1];var aC=(av-aB[2])/(24*60*60*1000);if(aC>30){return}if(typeof ax[aD]==="undefined"){ax[aD]=0}ax[aD]++});this.addExcludeRuleForAd(ax)},addExcludeRuleForAd:function(av){this.excludeRules.push(function(aw){var ay=aw.type.indexOf("ad")>-1;if((ay&&!aw.dsp)&w(av[aw.nid])){var ax=av[aw.nid];if(ax>=3){return false}}return true})},deleteDuplicatesDsp:function(az){var ax={};var aw=[];function av(aD){for(var aB=0;aB<aD.length;aB++){var aC=aB+"_"+aD[aB];if(ax[aC]){return false}else{ax[aC]=1}}return true}aj.forEach(av);for(var ay=0;ay<az.length;ay++){var aA=az[ay];if(aA.type==="ad"&&aA.dsp){if(!av(aA.hashData)){continue}}aw.push(aA)}return aw}});I.Class("Box",{init:function(aJ){var aE=this;this.timeoutId=false;this._canSendChannelImpLog=true;if(!aJ.selector&&!(aJ.selector=document.querySelector(aJ.selectorStr))){if(aE.timeoutId){clearTimeout(aE.timeoutId)}aE.timeoutId=setTimeout(function(){aE.init(aJ)},200);return}var ay=new I.ArticlesSelector(aJ);var aD=ay.getData();if(aD.length>0){var aF=aD.length%aJ.infiniteSize;if(aF!==0){aD=aD.slice(0,aD.length-aF)}aD.forEach(function(aK){aj.push(aK.hashData)});this.data=aD}if(aD.length<aJ.infiniteSize){return}var aG=false;for(var aB=0,aH=aD.length;aB<aH;aB++){var aA=aD[aB];if(aA.type=="cf"){aG=true;break}}this.template=aJ;var ax=aJ.cfChannelPrefix||k.cfChannelPrefix||"";var az=w(aJ.channelId)?aJ.channelId:false;if(aG&&az&&az.indexOf("with_sz_")!==0){az=ax+az}this.channelId=az;aJ.channelId=az;if(aq.adEnable){I.Log.adRequestLog()}I.Log.previewLog();I.Log.concatenationPVLog();this.renderBox();I.Performance.addTimeMark("box_did_render").addMark("is_box_rendered",true).report();i(this.container,function(){I.Log.boxInViewLog({channelId:az,isFeedModule:aJ.isFeedModule});if(az){I.Log.boxInViewLogs({channelId:az,isFeedModule:aJ.isFeedModule,boxPosition:this.boxPosition.getPosition()});I.Log.intextBoxInViewLog({channelId:az})}}.bind(this));if(az){I.Log.intextBoxRenderedLog({channelId:az,isFeedModule:aJ.isFeedModule})}if(w(V.common_category)){(function aw(aK,aM){try{if(aM<0){return}var aL=PopIn5.$.Context.findContext(aK);aL.segmentData.commonCategory=V.common_category;aL.segmentData.mainCategory=encodeURIComponent(V.category)}catch(aN){setTimeout(function(){aw(aK,--aM)},200)}})(this.container,20)}if(PopIn6.infinite.isEnable&&!PopIn6.infinite.isStart){PopIn6.infinite.isStart=true;PopIn6.event.fireEvent("infinite-loading",[])}var av=0;var aI=function(){if(typeof PopIn5!=="undefined"&&w(PopIn5.$)&&w(PopIn5.$.Config)){PopIn5.$.Config.apiHost=aq.apiHost;clearInterval(aC)}if(av>10){clearInterval(aC)}av++};var aC=setInterval(aI,500)},renderBox:function(){var aF=W(this.template.selector,"div","_popIn_recommend_container");if(w(this.template.containerId)){aF.setAttribute("id",this.template.containerId)}this.container=aF;this.boxPosition=new I.BoxPosition(this.container);this.adPosition=0;var aJ=W(aF,"div","_popIn_recommend_header",this.template.title);var aB=W(aF,"div","_popIn_recommend_articles");this.boxStyleMonitor=new I.BoxStyleMonitor(aF);var aw=this.data;var ax=aB;var aO=this.template.infiniteSize;var aH=this.template.infinitePages;var aA=this.template.channelId;var aD=this.template.isFeedModule;var ay=ad.valid?ad.session.get("_pi_article_recommend_type"):"";for(var aK=0,aM=aw.length;aK<aM;aK++){var aN=Math.floor(aK/aO);var az=aK%aO;if(aN>=aH){break}if(az===0){ax=W(aB,"div","_popIn_infinite_page")}var aE=new I.ArticleItem(aw[aK],this.template);aE.renderPosition=aK+1;aE.channelId=aA;aE.isFeedModule=aD;aE.referrerRecommendType=ay||"";var av=this.template.isFullClick?"a":"div";var aL=W(ax,av,"_popIn_recommend_article _popIn_idx"+(az+1));var aI=new I.ArticleRenderer(aL,aE,this.template);var aG=new I.ArticleStyleMonitor(aL);aE.element=aL;aE.articleStyleMonitor=aG;var aC=null;if(aI.ad===true){aC=this._onImpForAd;if(this.adPosition===0){this.positionAndStyle=new I.PositionAndStyle({channelId:aA,boxPosition:this.boxPosition,articleStyleMonitor:aG})}}else{aC=this._onImpForArticle}aE.adPosition=(aI.ad===true)?++this.adPosition:undefined;aE.boxStyleMonitor=this.boxStyleMonitor;H(aL,Object.assign({},aE));if(aE.trackingPixelConf&&aE.trackingPixelConf.trackingNodeId){u(aE.tracking_pixel);aE.tracking_pixel=undefined}i(aL,aC.bind(this,aE))}new I.BoxFooter(aF,this.template);if(typeof this.template.afterRender==="function"){this.template.afterRender(this)}PopIn6.event.fireEvent("after-render",this);new I.Video(aF,this.template);if(this.template.canInfiniteAds){new I.InfiniteAds(aF,this.template)}},_onImpForArticle:function(av){var aw=this.channelId;I.Log.articleInViewLog(av,{channelId:aw});PopIn6.event.fireEvent("article-imp",av)},_onImpForAd:function(av){I.Log.adBoxRenderedLog(av);var aw=this.channelId;if(aw){I.Log.adBoxRenderedLogs(av,{channelId:aw})}if(aw&&(this._canSendChannelImpLog===true)){I.Log.intextBoxImpLog({channelId:aw});this._canSendChannelImpLog=false}PopIn6.event.fireEvent("article-imp",av);if(w(av.debug)){return}var ax=Math.round((Date.now()-T)/1000);if(ax>60*30){return}setTimeout(function(){if(av.imp){var ay=new Image();ay.src=av.imp}I.Log.adInViewLog(av,{channelId:aw,boxPosition:this.boxPosition.getPosition()});if(av.dspObj){av.dspObj.execDspFunc("imp",av)}}.bind(this),1000)}});I.Class("BoxFooter",{init:function(av,aw){this.template=aw;if(aw.credit){var ax=W(av,((this.template.aboutPageType==="sameTab")?"a":"div"),"_popIn_recommend_credit",aw.credit);W(ax,"div","_popIn_recommend_credit_image");ax.addEventListener("click",this._onClick.bind(this))}},_onClick:function(){switch(this.template.aboutPageType){case"dialogue":this.showCredit();break;case"newTab":window.open("https://www.popin.cc/discovery/what-is.php");break}},close:function(){if(w(this.black)){document.body.removeChild(this.black);this.black=false}},showCredit:function(){var av=this;var az=function(){av.close()};var aA=W(document.body,"div");aA.id="_popIn_about_black";(function(aB){aB.position="fixed";aB.width="100%";aB.height="100%";aB.left="0px";aB.top="0px";aB.backgroundColor="rgba(0, 0, 0, 0.75)";aB.zIndex=9998})(aA.style);this.black=aA;aA.addEventListener("click",az);var ax=W(aA,"div");ax.id="_popIn_about_inner";(function(aB){aB.position="absolute";aB.width="500px";aB.height="450px";aB.left="50%";aB.top="50%";aB.marginLeft="-250px";aB.marginTop="-225px";aB.backgroundColor="white";aB.borderRadius="6px";aB.zIndex=9999})(ax.style);var aw=W(ax,"div");(function(aB){aB.position="absolute";aB.top="-18px";aB.left="-18px";aB.background="url(https://"+aa+"/images/close.png) no-repeat";aB.width="36px";aB.height="36px";aB.cursor="pointer"})(aw.style);aw.addEventListener("click",az);var ay=W(ax,"iframe");ay.src="https://www.popin.cc/discovery/what-is.php";ay.frameBorder="0";ay.scrolling="no";(function(aB){aB.width="480px";aB.height="430px";aB.border="0px";aB.margin="10px 0px 0px 10px"})(ay.style)}});I.Class("BoxPosition",{init:function(av){this.box=av;this.position=""},getPosition:function(){if(this.position){return this.position}if(window.self!==window.top){this.position="iframe"}else{this.position=M()==="mobile"?this.getPositionInMobile():this.getPositionInPc()}return this.position},getElementAbPosition:function(ax){var aw=ax.offsetLeft;var av=ax.offsetTop;while(ax=ax.offsetParent){aw+=ax.offsetLeft;av+=ax.offsetTop}return{left:aw,top:av}},getPositionInMobile:function(){var av=this.box.getBoundingClientRect();var aw=this.getElementAbPosition(this.box);var ay=aw.top+av.height/2;var ax=document.documentElement.scrollHeight;if(!ax||!ay){return"unknow"}else{if(ay<(ax/3)){return"top"}else{if(ay<(ax/3*2)){return"middle"}else{return"bottom"}}}},getPositionInPc:function(){var aw=this.box.getBoundingClientRect();var ay=this.getElementAbPosition(this.box);var aA=ay.top+aw.height/2;var ax=ay.left+aw.width/2;var az=document.documentElement.scrollHeight;var av=document.documentElement.scrollWidth;if(!az||!av||!aA){return"unknow"}return[(aA<(az/2))?"top":"bottom",(ax<(av/2))?"left":"right"].join("_")}});I.Class("BoxStyleMonitor",{init:function(av){this.boxNode=av;this.styleFlag=""},getStyleFlag:function(){if(this.styleFlag){return this.styleFlag}var ay=this.boxNode.querySelectorAll("._popIn_infinite_page:first-child ._popIn_recommend_article");var ax="";for(var aw=0,av;av=ay[aw];aw++){var az=ar(av,"articleStyleMonitor");if(!az){ax+="_";continue}ax+=az.getStyleFlag()}return(this.styleFlag=ax)}});I.Class("BrandSafety",{init:function(){this.impIdArry=[]},process:function(aw,av){av=av||{};if(!av.logid){return false}this.logid=av.logid||"";this.media=av.media||location.host;this.apiHost=av.apihost||"jp.popiin.cc";this.impIdArry[this.logid]=(typeof this.impIdArry[this.logid]!=="undefined")?this.impIdArry[this.logid]+1:1;this._momentumTagRender(aw)},_momentumTagRender:function(ax){var aA="jp.popin.cc";if(aA!==this.apiHost){return}var aB=38,aw="UUID_DIV",aC=this.logid,av=this.impIdArry[this.logid],ay=this.media,aD=document.createElement("script");aD.src="//assets-momentum.akamaized.net/js/axss.js";ax.classList.add(aw);var az=function(){momentum_heron.set_postbid_observer(aw,aB,aC,String(av),ay,{dest:"http://jp.popin.cc/popin_discovery/pbc",payload:{ext:{momentum:{heron:{require:[1,2,4]}}}}})};if(typeof aD.onload!=="undefined"){aD.onload=az}else{if(aD.readyState){aD.onreadystatechange=az}}document.body.appendChild(aD)}});I.Class("Config",{init:function(az){az=az||{};this.setDefaults(az);var aw=this.findConfig(q);if(!aw){return}for(var ay in aw){this[ay]=aw[ay]}for(var av in k){this[av]=k[av]}var ax=[];if(w(aw.templates)){aw.templates.forEach(function(aA){ax.push(new I.Template(aA))})}this.templates=ax;this.positionAndStyleObj=I.PositionAndStyle.getPositionAndStyle();this.afterConfig()},setDefaults:function(av){this.device=(M()!=="mobile")?"pc":"mobile";this.target=typeof av!=="undefined"?av.target||location.href:location.href;this.media=location.host;this.agency="popinag";this.topn=50;this.pathnum=null;this.ad=10;this.country=false;this.apiUrl=window.PopIn6.protocol+"//discoveryplus.popin.cc/popin_discovery/recommend?";this.isArticle=true;this.segmentData={};this.apiUrlAdd=""},afterConfig:function(){var av=this;this.target=F(this.target,this.urlReplace);var ay=[];ay.push("device="+this.device);ay.push("media="+this.media);ay.push("extra="+D().toLowerCase());ay.push("agency="+this.agency);ay.push("topn="+this.topn);var aw=[[w(this.cfid),"cfid="+this.cfid],[w(this.adEnable),"ad="+this.ad],[w(this.pathnum),"pathnum="+this.pathnum],[w(this.apiUrlAdd),this.apiUrlAdd.replace(/^&/,"")],[!w(this.isArticle),"related=false"],[true,"piuid="+S.getUid()],[w(PopIn6.smjId),"smjid="+PopIn6.smjId]];aw.forEach(function(az){if(az[0]){ay.push(az[1])}});this.apiUrl=this.apiUrl.replace("%target",encodeURIComponent(this.target)+"&");if(this.apiUrl.indexOf("url=")===-1){ay.push("url="+encodeURIComponent(this.target))}this.apiUrl+=(this.apiUrl.indexOf("?")>-1?(this.apiUrl.slice(-1)!=="?"?"&":""):"?")+ay.join("&");var ax=location.href.match(/popincampaign=([^&]+)/);if(ax){this.apiUrl+="&popindemo="+ax[1]}this.apiUrl+="&info="+this.createInfoData();this.apiHost=ac(this.apiUrl).host.replace("discoveryplus.","jp.");this.setSzAdLtrByBatch()},createInfoData:function(){var aw=this.getUserTdInfo();aw.user_device=this.device;aw.user_time=T;aw.fruit_box_position=this.positionAndStyleObj.boxPosition;aw.fruit_style=this.positionAndStyleObj.adStyleMonitor;var av=location.href.match(/popin_sid_sample=([^&]+)/);if(av){aw.sid_sample=av[1]}PopIn6.event.fireEvent("after-create-info-data",aw);return btoa(unescape(encodeURIComponent(JSON.stringify(aw))))},findConfig:function(ay){var ax=(M()!=="mobile")?"pc":"mobile";var aw=w(N)?[ax+"-test",ax,"all-test","all"]:[ax,"all"];for(var av=0;av<aw.length;av++){var az=aw[av];if(ay[az]&&ay[az].Discovery){return ay[az].Discovery}}return false},getUserTdInfo:function(){if(!this.userTdData){var ax=at;var aw={};for(var av in ax){aw["user_td_"+av]=av=="title"?encodeURIComponent(ax[av]):ax[av]}this.userTdData=aw}return this.userTdData},sortModuleByDom:function(aD){var az=[];var av=[];var ax=[];for(var ay=0,aC=aD.length;ay<aC;ay++){if(!aD[ay].selector){av.push(aD[ay]);continue}az.push(aD[ay]);if(aD[ay].selectorStr){ax.push(aD[ay].selectorStr)}}var aw=document.querySelectorAll(ax.join(","));var aA=Array.prototype.slice.call(aw,0);for(var ay=0,aC=az.length-1;ay<aC;ay++){var aB=az[ay];for(j=0,jl=az.length-1-ay;j<jl;j++){if(aA.indexOf(az[j].selector)>aA.indexOf(az[j+1].selector)){var aE=az[j];az[j]=az[j+1];az[j+1]=aE}}}return az.concat(av)},setSzAdLtrByBatch:function(){if((this.apiHost!=="tw.popin.cc"&&this.apiHost!=="jp.popin.cc")||"ignore"===this.useForSzAdLtrRatio||this.apiUrl.indexOf("&alg=ltr")!==-1||this.apiUrlAdd.indexOf("&alg=ltr")!==-1){return}if(typeof this.useForSzAdLtrRatio==="number"){if(Math.random()<=this.useForSzAdLtrRatio){this.apiUrl=this.apiUrl+"&alg=ltr";this.appenedAdLtrPrefix()}}else{this.apiUrl=this.apiUrl+"&alg=ltr"}},appenedAdLtrPrefix:function(){var ax=this.useSzAdLtrChannelIdPrefix===undefined?"":this.useSzAdLtrChannelIdPrefix;for(var av=0;av<this.templates.length;av++){var aw=this.templates[av];if(aw.channelId&&aw.channelId.indexOf("with_sz_")!==0){aw.channelId=ax+aw.channelId}}}});I.Class("Criteo",{init:function(av,aw){this.createProxy(av,aw);this.aspectArticleRendererAd();this.aspectDiscoveryLog()},createProxy:function(ay,aA){var aC=function(){aA(ay)};var ax=aq.criteoZoneId||"1097335";var aw=aq.criteoCampaignId||"5a1407ff211463e92a72d121";var az=aq.criteoNId||"5a140913211463152b72d121";var aB=window.PopIn6.protocol+"//cas.criteo.com/delivery/0.1/napi.jsonp?zoneid="+ax;var av=this;G(aB,function(aD){if(w(aD)&&aD.response_status===0||N){return av.setArticleFromProduct(ay,aD,aA,ax,aw,az)}aC()})},setArticleFromProduct:function(aG,aA,ay,ax,aD,av){if(N&&aA.response_status!==0){aA={};aA.products=[{title:"Red shoes",description:"Male running shoes",price:"$ 120",click_url:"http://cat.criteo.com/delivery/ck.php",image:{url:"http://images.popin.cc/discovery/667d8c9b2cdfec7b74b19c8d8f9355f7.png",width:160,height:160}},{title:"Blue shoes",description:"Male running shoes.",price:"$ 120",click_url:"http://cat.criteo.com/delivery/ck.php?debug=true",image:{url:"http://images.popin.cc/discovery/667d8c9b2cdfec7b74b19c8d8f9355f7.png",width:160,height:160}}];aA.privacy={optout_click_url:"http://info.criteo.com/pac/privacy/informations",optout_image_url:"http://static.criteo.net/flash/icon/nai_small.png"};aA.advertiser={logo:{url:"http://images.eu.criteo.net/img/img?c=1&l=1&h=70&w=70",width:70,height:70},logo_click_url:"http://cat.criteo.com/delivery/ck.php",description:"Advertiser",domain:"advertiser.com"};aA.impression_pixels=[{url:"http://cat.criteo.com/delivery/lg.php"},{url:"http://www.advertiser.com/impression.gif"}]}aG.ad_criteo=[];var aw=Math.min(aA.products.length,aG.ad.length);for(var az=0;az<aw;az++){var aE=aA.products[az];var aF={};var aC=aG.ad[az].url;aF.criteo=aA;aF.criteoProduct=aE;aF.title=aE.title;aF.image=aE.image.url;aF.nid=av;aF.campaign=aD;var aB="https://a.popin.cc/popin_redirect/redirect?url={{url}}&nid={{nid}}&campaign={{campaign}}&media={{media}}&device={{device}}&category=criteo&t={{time}}&token={{token}}&uid={{uid}}&nc=1";aB=aB.replace(/{{url}}/,encodeURIComponent(aE.click_url));aB=aB.replace(/{{nid}}/,av);aB=aB.replace(/{{campaign}}/,aD);aB=aB.replace(/{{media}}/,aq.media);aB=aB.replace(/{{device}}/,aq.device);aB=aB.replace(/{{time}}/,Date.now());aB=aB.replace(/{{token}}/,Math.random().toString().replace(/\./,""));aB=aB.replace(/{{uid}}/,aC.match(/uid=(.+)/)[1]);aF.url=aB;aF.userid=aA.advertiser.description;aF.domain=aA.advertiser.domain;aG.ad_criteo.push(aF)}return ay(aG)},aspectArticleRendererAd:function(){var aw=I.ArticleRenderer.prototype;var av=aw.render;aw.render=function(){if(w(this.article.criteo)){this.article.media=this.article.criteo.advertiser.domain}av.apply(this,[])};var ax=aw.addLinkEvent;aw.addLinkEvent=function(){ax.apply(this,[]);if(w(this.article.criteo)){var aB=this.article;var aC=function(aD){if(aD.classList.contains("_popIn_3rdparty")){aD.href=aB.criteo.privacy.optout_click_url;return}};var az=Array.prototype.slice.call(this.articleDiv.querySelectorAll("A"));var aA=this.template;var ay=this.ad;if(aA.isFullClick){if(!ay){az=[this.articleDiv]}else{az.push(this.articleDiv)}}az.forEach(function(aD){aC(aD)})}}},aspectDiscoveryLog:function(){var av=I.Log.adInViewLog;var aw=I.Log.adRequestLog;var ax=function(aB){var az=aB.impression_pixels;if(!w(az)){return}for(var aA=0;aA<az.length;aA++){var ay=az[aA];var aC=new Image();aC.src=ay.url}ax=function(){}};I.Log.adInViewLog=function(az){var ay=w(az.criteo)?{common_category:"criteo"}:{};if(w(az.criteo)){av.apply(this,[az,ay]);I.Log.adCriteoInViewLog(az,ay);ax(az.criteo)}else{av.apply(this,[az,ay])}};I.Log.adRequestLog=function(){aw.apply(this,[]);I.Log.adCriteoRequestLog()}}});I.Class("CSSManager",{init:function(){this.cache=[];this.css=""},add:function(aw){var ax=af(aw);var av=this.cache.some(function(ay){return ax===ay});if(!av){this.css+=aw;this.cache.push(ax)}},render:function(){var av=document.createElement("style");av.type="text/css";av.rel="stylesheet";av.charSet="UTF-8";document.getElementsByTagName("head")[0].appendChild(av);av.appendChild(document.createTextNode(this.css))}});I.Class("Dsp",{init:function(av){this._dspName=av||"";this._dspObj={}},setup:function(aw,ax){var av="Dsp"+this._dspName.charAt(0).toUpperCase()+this._dspName.slice(1);if(I[av]){this._dspObj=new I[av](aw,ax)}else{return false}return true},execDspFunc:function(ax,av){var aw="_"+ax;if(this._dspObj[aw]){this._dspObj[aw](av)}}});I.Class("DspLogicad",{init:function(av,aw){this.item=av;this.parameter=aw||{}},_sendImgRequest:function(aw){var av=new Image();av.src=aw},_imp:function(av){if(this.item.nurl){this._sendImgRequest(this.item.nurl)}if(Array.isArray(this.item.imptrackers)){this.item.imptrackers.forEach(function(aw){this._sendImgRequest(aw)},this)}},_click:function(){if(Array.isArray(this.item.clicktrackers)){this.item.clicktrackers.forEach(function(av){this._sendImgRequest(av)},this)}}});I.Class("InfiniteAds",{init:function(av,aw){if(M()!=="mobile"){return}this.container=av;this.template=aw;if(typeof PopIn6.infiniteCounter==="undefined"){PopIn6.infiniteCounter=0}this.ic=w(aq.infiniteSerializeEnable)?PopIn6.infiniteCounter:0;this.slots=this.getSlots();this.ads=this.getAds();if(w(this.slots)&&w(this.ads)){this.renderAds()}},getSlots:function(){var av=this.container.querySelectorAll("._popIn_infinite_page");var ax=[];for(var aw=0,az=av.length;aw<az;aw++){var ay=av[aw];if(w(ay.querySelector("._popIn_infinite_video"))){continue}ax.push(ay)}return ax},getAds:function(){var av=[].concat(w(V.infinite)?V.infinite:[]);return av},renderAds:function(){var av=this.ic;for(var aw=0,az=this.slots.length;aw<az;aw++){var ay=this.slots[aw];var ax=this.ads[av%this.ads.length];if(w(ax)&&ax.type==="ad"){this.renderOneAd(ay,ax)}av++}PopIn6.infiniteCounter=av},renderOneAd:function(aB,aw){var aA=W(document.createDocumentFragment(),"div","_popIn_infinite_ad");aA.style.height=aw.height+"px";var az=(this.template.infiniteAdInsertPosition||"beforeend").toLowerCase();switch(az){case"beforebegin":aB.parentNode.insertBefore(aA,aB);break;case"afterbegin":aB.insertBefore(aA,aB.firstChild);break;case"beforeend":aB.appendChild(aA);break;case"afterend":aB.parentNode.insertBefore(aA,aB.nextSibling);break}var ax=[];ax.push('<body style="margin:0px;padding:0px;background-color: transparent;">');ax.push("<script>window.inDapIF = true;<\/script>");ax.push(aw.script);ax.push("</body>");var av=A("about:self",{pnode:aA});(function(aC){aC.width=aw.width+"px";aC.height=aw.height+"px";aC.margin="0px auto"})(av.element.style);var ay=function(){av.write(ax.join(""))};if(w(aq.adInView)){i(aA,ay)}else{ay()}}});I.Class("Loader",{init:function(){function az(aB){var aF=aB.ad;var aE=aB.ad_smj;if(!aF||aq.isShowSmjAd===false||!Array.isArray(aE)||aE.length===0){return}if(aF.length===0){aB.ad=aE;return}var aG={};var aD=0;var aH=[];var aC;while(aC=aE[aD++]){aG[aC.nid]=1;aC.url+="&smjad=1";aC.isSmjAd=true;aH.push(aC)}aD=0;while(aC=aF[aD++]){if(!aG[aC.nid]){aH.push(aC)}}aB.ad=aH}var aw=function(aC){V=aC;window.popInGlobal=window.popInGlobal||{};window.popInGlobal.common_category=aC.common_category;if(aC.article_read){window.popInGlobal.articleReadLogForRT={articleId:aC.article_read}}PopIn6.event.fireEvent("result-loaded",[aC]);if(!w(PopIn6.uid)&&w(aC)){var aE=function(aJ){if(ad.valid&&w(aJ)){ad.session.set("_ss_pp_id",aJ);ad.local.set("_ss_pp_id",aJ)}};var aG=V.cookie;if(w(aG)&&w(aG.uid)){PopIn6.uid=aG.uid;aE(aG.uid)}else{var aD=A("https://api.popin.cc/retarget/uid.html?ac=getuid");var aI=aD.window;window.addEventListener("message",function(aJ){if(aI===aJ.source){aE(aJ.data)}},false)}}if(!w(aq.templates)){return}var aB=new I.CSSManager();var aH=aq.templates.filter(function(aJ){var aK=aJ.type.slice(-1)[0];if(typeof aK==="number"&&aK===0){return false}aB.add(aJ.css);return true});aB.render();az(V);var aF=new I.BrandSafety();aH.forEach(function(aJ){var aK=new I.Box(aJ);if(aK.container){aF.process(aK.container,{logid:V.logid,media:aq.media,apihost:aq.apiHost})}});if(aH.length===0){PopIn6.event.fireEvent("no-content",[])}else{PopIn6.event.fireEvent("start-render",[])}if(aq.isArticle){I.Log.relatedLog();I.Log.snsLog()}PopIn6.event.fireEvent("cehck-update",[V]);return};if(window.context&&(window.context.tagName==="AMP-AD")){this._editTemplatesForAMP(aq.templates);PopIn6.event.addEventListener("start-render",function(){setTimeout(function(){var aD=document.getElementById("_popIn_amp_recommend");var aC=aD.offsetWidth+"px";var aB=aD.offsetHeight+"px";window.context.renderStart({width:aC,height:aB})},1)});PopIn6.event.addEventListener("no-content",function(){window.context.noContentAvailable()});window.context.onResizeDenied(function(aC,aB){setTimeout(function(){window.context.requestResize(aB,aC)},500)})}var ay=function(){I.Performance.addTimeMark("api_will_request");var aE=aq.thirdParty;var aB=false;if(w(aE)){var aC=function(aG,aF,aH){return aG.indexOf("criteo")>-1};aB=aE.some(aC)}if(aB){var aD=aw;aw=function(aF){new I.Criteo(aF,aD)}}PopIn6.event.fireEvent("before-loaded",[aq]);G(aq.apiUrl,function(aF){if(N>0){window._popIn_discovery_test={result:aF,callback:aw};var aH=document.createElement("script");aH.type="text/javascript";aH.charset="UTF-8";aH.async=true;aH.src="https://i.popincdn.com/test/discovery_test6.js";var aG=document.getElementsByTagName("script")[0];aG.parentNode.insertBefore(aH,aG);return}else{I.Performance.addTimeMark("api_data_will_deal");aw(aF)}})};ay();if(w(aq.templates)){var ax=aq.templates.some(function(aB){return w(aB.selectorStr)&&aB.selectorStr==="._popIn_recommend"});PopIn6.infinite={};PopIn6.infinite.isEnable=ax;PopIn6.infinite.isStart=false;if(ax){var aA=[];if(document.querySelector("._popIn_recommend")){aA.push(document.querySelector("._popIn_recommend"))}var av=function(){var aB=function(aK,aH){var aJ=false;for(var aI=0,aL=aH.length;aI<aL;aI++){if(aK===aH[aI]){aJ=true;break}}return aJ};var aC=function(aJ){var aH=aJ.getAttribute("data-url");aq.templates.forEach(function(aK){if(w(aK.selector)&&aK.selectorStr==="._popIn_recommend"){aK.selector=aJ}});aq.setDefaults();var aI=aq.findConfig(q);if(aI){aq.apiUrl=aI.apiUrl}aq.target=aH;aq.afterConfig();ay()};var aD=document.querySelectorAll("._popIn_recommend");for(var aE=0,aG=aD.length;aE<aG;aE++){var aF=aD[aE];if(!aB(aF,aA)){aA.push(aF);aC(aF)}}};PopIn6.event.addEventListener("infinite-loading",function(aB){setInterval(av,100)},false)}}},_editTemplatesForAMP:function(ax){if(!ax){return}var ay;for(var aw=0,av=ax.length;aw<av;aw++){ay=ax[aw];if(typeof ay==="object"){ay.isTargetTop=true;ay.aboutPageType="sameTab"}}}});I.Log={loggers:{},_addLogger:function(av,aw){this.loggers[av]=aw;for(var ax in aw){if(ax.indexOf("_")===0){continue}this._addLogFunction(ax)}},_addLogFunction:function(av){if(w(this[av])){return}this[av]=function(){try{var aw=Array.prototype.slice.call(arguments);PopIn6.log(function(ay){var aA=I.Log.loggers[ay.type];var az=aA[av];if(typeof az==="function"){var aB=[ay].concat(aw);az.apply(aA,aB);ay.execute()}})}catch(ax){console.error(ax)}}}};I.Log._addLogger("basic",{_addSegmentation:function(ay,ax){ax=ax||{};var az=[];var aB=[];var aw=ay.data.length-1;while(aw>=0){if(ay.data[aw].indexOf("r5=")>-1){var av=ay.data.splice(aw,1);aB.push(av[0].split("=")[1])}aw-=1}az.push(["ca",V.category]);var aC=w(ax.common_category)?ax.common_category:V.common_category;if(w(aq.segmentData.abtest)){az.push(["ab",aq.segmentData.abtest])}if(w(ax.useCommonCategory)){az.push(["cc",aC])}if(w(ax.onlyCommonCategory)){az=[["cc",aC]]}if(w(ax.extra)){az=az.concat(ax.extra)}az.forEach(function(aD){if(w(aD[1])){var aE=aD[0];var aF=aD[1];aF=Array.isArray(aF)?aF:[aF];if(aE==="cc"){aF=[aF[0]]}aF.forEach(function(aG){aB.push(aE+"_"+encodeURIComponent(aG))})}});var aA=V.channel;if(aA){if("string"===typeof aA){aA=[aA]}if(Array.isArray(aA)){aA.forEach(function(aD){aB.push(aD)})}}ay.add("r5",aB.join("|"))},relatedLog:function(av){av.mode="other";var aw=/(jp|tw|kr|sg|th).popin.cc/.test(aq.apiUrl)?"related-"+RegExp.$1:"related";av.add("type",aw);av.add("uid","");av.add("url",encodeURIComponent(aq.target));av.uniqueId="related"},snsLog:function(av){av.valid=false;if(Math.random()<1/10){G("https://graph.facebook.com/?ids="+encodeURIComponent(aq.target),function(aw){var az=0;try{for(var ax in aw){az+=aw[ax].share.share_count}}catch(aA){}if(az>=30){av.valid=true}var ay=/(jp|tw|kr|sg|th).popin.cc/.test(aq.apiUrl)?"share-"+RegExp.$1:"share-jp";av.add("url",encodeURIComponent(aq.target));av.add("share",az);av.add("type",ay);av.execute()})}},previewLog:function(av){av.add("url",encodeURIComponent(aq.target));av.add("uid",PopIn6.uid);av.add("type",aq.device+"_pv");av.add("nid",aq.device);av.add("media",aq.media);av.uniqueId="pv";this._addSegmentation(av)},boxInViewLog:function(av){av.add("url",encodeURIComponent(aq.target));av.add("uid",PopIn6.uid);av.add("type",aq.device+"_inview");av.add("nid",aq.device);av.add("media",aq.media);av.uniqueId="inview";this._addSegmentation(av)},articleClickLog:function(aw,ay,av,ax){aw.add("url","");aw.add("uid",PopIn6.uid);aw.add("type",aq.device+"_rclick");aw.add("nid",aq.device);aw.add("media",aq.media);this._addSegmentation(aw,{extra:[["ch",ax.channelId]]});aw.onError=av;aw.onComplete=av},adBoxRenderedLog:function(av,aw){av.add("url",encodeURIComponent(aq.target));av.add("uid",PopIn6.uid);av.add("type",aq.device+"_imp");av.add("nid","");av.add("media",aq.media);av.uniqueId="imp";this._addSegmentation(av,{onlyCommonCategory:true})},adInViewLog:function(aw,ax,av){if(ax.imp){aw.valid=false}av=av||{};av.common_category=w(av.common_category)?av.common_category:"";aw.trackingPixel=ax.trackingPixel;aw.add("url",encodeURIComponent(aq.target));aw.add("uid",PopIn6.uid);aw.add("type",aq.device+"_imp");aw.add("nid",ax.nid);aw.add("campaign",ax.campaign);aw.add("media",aq.media);this._addSegmentation(aw,{onlyCommonCategory:true,common_category:av.common_category});aw.add("r6",ax.token);if(w(ax.trackingPixel)){u(ax.trackingPixel)}else{if(w(ax.tracking_pixel)){u(ax.tracking_pixel)}}},intextBoxRenderedLog:function(av,aw){av.add("url",encodeURIComponent(aq.target));av.add("uid","");av.add("type",aq.device+"_channel_pv");av.add("nid",aq.device);av.add("media",aq.media);this._addSegmentation(av,{extra:[["ch",aw.channelId]]})},intextBoxInViewLog:function(av,aw){av.add("url",encodeURIComponent(aq.target));av.add("uid","");av.add("type",aq.device+"_channel_inview");av.add("nid",aq.device);av.add("media",aq.media);this._addSegmentation(av,{extra:[["ch",aw.channelId]]})},intextBoxImpLog:function(av,aw){av.add("url",encodeURIComponent(aq.target));av.add("uid","");av.add("type",aq.device+"_channel_imp");av.add("nid","");av.add("media",aq.media);this._addSegmentation(av,{extra:[["ch",aw.channelId]]})},videoLog:function(av,ax,aw){if(aw=="imp"){av.valid=false}av.add("url",encodeURIComponent(aq.target));av.add("uid",PopIn6.uid);av.add("type",aq.device+"_video_"+aw);av.add("nid",ax.video.nid);av.add("campaign",ax.video.campaign);av.add("media",aq.media);av.add("r5","cc_video");if((""+aw)==="100"){this._addSegmentation(av,{useCommonCategory:true})}av.add("r6","video_imp")}});I.Log._addLogger("treasure",{_addSegmentation:function(ax,aw){aw=aw||{};var ay=w(aw.common_category)?aw.common_category:V.common_category;if(w(ay)){ax.add("common_category",Array.isArray(ay)?ay[0]:ay)}ax.add("category",V.category);if(w(aq.segmentData.abtest)){ax.add("abtest",aq.segmentData.abtest)}var av=w(aw.extra)?"m_"+aw.extra[0].join("_"):"";ax.add("extra",av)},_setCommon:function(av){av.add("api_host",aq.apiHost);av.add("device",aq.device);av.add("media",aq.media);av.add("url",aq.target);if(w(V.logid)){av.add("logid",V.logid)}if(w(V.rid)){av.add("rid",V.rid)}av.add("popin_user_id",S.getUid());var ax=av.getTrackValues();ax.td_title=V.title||"";for(var aw in ax){av.add(aw,ax[aw])}av.add("client_id",ax.td_client_id);av._uainfo=at},adRequestLog:function(av){var ax=aq.apiUrl+"&"+aq.apiUrlAdd;var aw=(ax.match(/[\?&]rid=([^&]+)/)||["",""])[1];var ay=(ax.match(/[\?&]alg=([^&]+)/)||["",""])[1];av.db="popin_ads";av.table="adlogs";av.add("type","req");av.add("rid",aw);av.add("alg",ay);av.add("time_show_seconds",Math.round((Date.now()-T)/1000));av.add("request_ad",aq.ad);av.add("response_ad",V.ad.length);av.add("smjad",(V.ad_smj&&V.ad_smj.length)>0?1:0);av.add("af",(V.af)?V.af+"":"");this._setCommon(av);this._addSegmentation(av)},adCriteoRequestLog:function(aw,av){aw.db="popin_ads";aw.table="adcriteo";aw.add("type","req");aw.add("time_show_seconds",Math.round((Date.now()-T)/1000));aw.add("request_ad",aq.ad);aw.add("response_ad",V.ad.length);this._setCommon(aw);this._addSegmentation(aw)},adInViewLog:function(aw,ay,av){av=av||{};av.common_category=w(av.common_category)?av.common_category:"";aw.db="popin_ads";aw.table="adlogs";aw.add("type",ay.reserved?"reserved_imp":"imp");aw.add("time_show_seconds",Math.round((Date.now()-T)/1000));aw.add("nid",ay.nid);aw.add("campaign",ay.campaign);aw.add("token",ay.token);aw.add("timestamp",Date.now());aw.add("recommend_position",ay.renderPosition);aw.add("ad_position",ay.adPosition);aw.add("channel_id",av.channelId);aw.add("is_feed_module",ay.isFeedModule);if(ay.c1){aw.add("c1",ay.c1)}if(ay.c2){aw.add("c2",ay.c2)}aw.add("title",ay.title||"");aw.add("sample",ay.sample||"");aw.add("v_fruit_word",ay.v_fruit_word||"");aw.add("image_hash",ay.image_hash||"");aw.add("classify",ay.classify||"");aw.add("image",ay.image||"");if(ay.clarity!=="undefined"){aw.add("clarity",ay.clarity)}if(ay.aesthetic!=="undefined"){aw.add("aesthetic",ay.aesthetic)}if(V.sample_tag){aw.add("sample_tag",V.sample_tag)}aw.add("smjad",ay.isSmjAd?1:0);this._setCommon(aw);this._addSegmentation(aw,{common_category:av.common_category});var ax=ar(ay.element);aw.add("fruit_style",ax.articleStyleMonitor&&ax.articleStyleMonitor.getStyleFlag());aw.add("box_style",ax.boxStyleMonitor&&ax.boxStyleMonitor.getStyleFlag());aw.add("referrer_recommend_type",ax.referrerRecommendType)},adCriteoInViewLog:function(aw,ax,av){av=av||{};av.common_category=w(av.common_category)?av.common_category:"";aw.db="popin_ads";aw.table="adcriteo";aw.add("type",ax.reserved?"reserved_imp":"imp");aw.add("time_show_seconds",Math.round((Date.now()-T)/1000));aw.add("nid",ax.nid);aw.add("campaign",ax.campaign);aw.add("token",ax.token);aw.add("timestamp",Date.now());if(ax.c1){aw.add("c1",ax.c1)}if(ax.c2){aw.add("c2",ax.c2)}if(V.sample_tag){aw.add("sample_tag",V.sample_tag)}this._setCommon(aw);this._addSegmentation(aw,{common_category:av.common_category})},adClickLog:function(aw,ax,av){aw.db="popin_ads";aw.table="adlogs";aw.add("type","click");aw.add("time_show_seconds",Math.round((Date.now()-T)/1000));aw.add("nid",ax.nid);aw.add("campaign",ax.campaign);aw.add("token",ax.token);aw.add("position",ax.renderPosition);aw.add("timestamp",Date.now());if(ax.c1){aw.add("c1",ax.c1)}if(ax.c2){aw.add("c2",ax.c2)}if(V.sample_tag){aw.add("sample_tag",V.sample_tag)}aw.add("smjad",ax.isSmjAd?1:0);this._setCommon(aw);this._addSegmentation(aw,{extra:[["ch",av.channelId]]})},adMediaDnaLog:function(av,aw){av.db="popin_media";av.table="mediadna_clicks";av.add("campaign_id",aw.campaign);av.add("timestamp",Date.now());this._setCommon(av)},concatenationPVLog:function(aw){var av=window._popIn_concatenation_param;aw.db="popin_media";aw.table="pageview_concatenation";aw.uniqueId="concatnation_pv";if(!w(av)){aw.valid=false}else{aw.add("user_id",av.user_id);aw.add("useragent_popin",av.useragent);if(location.href.indexOf("tabelog.com")>-1){aw.add("pv_time",av.pv_time);aw.add("pv_hostname",location.host)}aw.add("timestamp",Date.now())}},previewLog:function(av){av.db="popin_media";av.table="discoverylogs";av.uniqueId="pv";av.add("r_url","");av.add("type",0);this._setCommon(av);this._addSegmentation(av)},articleInViewLog:function(ax,aA,aw){ax.db="popin_media";ax.table="discoverylogs";ax.add("r_url",aA.url);ax.add("type",1);ax.add("recommend_type",aA.type);ax.add("recommend_position",aA.renderPosition);ax.add("channel_id",aw.channelId||"");ax.add("is_feed_module",aA.isFeedModule);if(aA.type==="cf"){if(aA.RecallRefer){var az=aA.RecallRefer;if(Array.isArray(az)){az=az.join("|")}ax.add("recall_refer",az)}var av=V.identity;if(typeof av==="object"){for(var ay in av){if(av.hasOwnProperty(ay)){ax.add(ay,av[ay])}}}}this._setCommon(ax);this._addSegmentation(ax)},articleClickLog:function(ax,aB,av,aA){ax.db="popin_media";ax.table="discoverylogs";ax.add("r_url",aB.url);ax.add("type",2);ax.add("recommend_type",aB.type);ax.add("recommend_position",aB.renderPosition);ax.add("is_feed_module",aB.isFeedModule);ax.add("channel_id",aA.channelId||"");if(aB.type==="cf"){if(aB.RecallRefer){var az=aB.RecallRefer;if(Array.isArray(az)){az=az.join("|")}ax.add("recall_refer",az)}var aw=V.identity;if(typeof aw==="object"){for(var ay in aw){if(aw.hasOwnProperty(ay)){ax.add(ay,aw[ay])}}}}this._setCommon(ax);this._addSegmentation(ax,{extra:[["ch",aA.channelId]]})},boxInViewLog:function(av,aw){av.db="popin_media";av.table="discoverylogs";av.add("r_url","");av.add("type",3);av.add("is_feed_module",aw.isFeedModule);av.uniqueId="inview";this._setCommon(av);this._addSegmentation(av)},adBoxRenderedLog:function(av,aw){av.db="popin_media";av.table="discoverylogs";av.add("r_url","");av.add("type",4);av.add("is_feed_module",aw.isFeedModule);av.uniqueId="imp";this._setCommon(av);this._addSegmentation(av)},boxInViewLogs:function(av,aw){av.db="popin_media";av.table="discoverylogs";av.add("r_url","");av.add("type",5);av.add("channel_id",aw.channelId);av.add("is_feed_module",aw.isFeedModule);av.add("box_position",aw.boxPosition);this._setCommon(av);this._addSegmentation(av)},adBoxRenderedLogs:function(av,aw){av.db="popin_media";av.table="discoverylogs";av.add("type",6);av.add("channel_id",aw.channelId);av.add("is_feed_module",aw.isFeedModule);av.uniqueId="imp";av.typeIndex=6;av.channelId=aw.channelId;this._setCommon(av);this._addSegmentation(av)},intextBoxRenderedLog:function(av,aw){av.db="popin_media";av.table="discoverylogs";av.add("type",7);av.add("is_feed_module",aw.isFeedModule||"");av.add("channel_id",aw.channelId||"");this._setCommon(av);this._addSegmentation(av)},videoLog:function(av,ax,aw){av.db="popin_ads";av.table="adlogs";av.add("api_host",aq.apiHost);av.add("type","video_"+aw);av.add("time_show_seconds",Math.round((Date.now()-T)/1000));av.add("nid",ax.video.nid);av.add("campaign",ax.video.campaign);av.add("timestamp",Date.now())},videoMediaDnaLog:function(av,ax,aw){av.db="popin_media";av.table="mediadna_clicks";av.add("campaign_id",ax.video.campaign);av.add("timestamp",Date.now());this._setCommon(av)},checkSmjIdLog:function(av,ay,aw){av.db="popin_ads";av.table="smj_id";av.add("action","localStorage");av.add("key",PopIn6.smjId);var ax=window===top?location.host:(document.referrer.match(/^https?:\/\/([^\/]+)/)||[0,""])[1];av.add("host",ax)}});I.Log._addLogger("inrecsys",{_setCommon:function(av){var ax=av.getTrackValues();ax.td_title=V.title||"";for(var aw in ax){av.add(aw,ax[aw])}var az=V.common_category;if(w(az)){av.add("dish_common_category",Array.isArray(az)?az[0]:az)}av.add("key","key"+T);av.add("now",Date.now());av.add("client_id",ax.td_client_id);av.add("url",aq.target);av.add("popin_user_id",S.getUid());av.add("smjId",PopIn6.smjId||"");av.add("device",aq.device);av.add("dish_media",aq.media);av.add("dish_category",V.category||"");av.add("dish_domain",location.host);av.add("td_ip",V.ip||"");if(w(V.logid)){av.add("logid",V.logid)}av.add("api_host",aq.apiHost);var ay=["td_browser","td_browser_version","td_os","td_os_version"];ay.forEach(function(aA){av.add(aA,at[aA.replace(/td_/,"")])})},_setArticleData:function(aw,aA){aw.add("dish_td_title",V.title||"");aw.add("dish_pubdate",V.pubdate||"");aw.add("dish_td_url",encodeURIComponent(aq.target));var aB=aA.originalUrl;var az=aA.common_category||"";aw.add("fruit_common_category",Array.isArray(az)?az[0]:az);aw.add("fruit_domain",ac(aB).host);aw.add("fruit_td_title",aA.title);aw.add("fruit_pubdate",aA.pubdate);aw.add("fruit_category",aA.category);aw.add("fruit_td_url",aA.pureUrl);aw.add("fruit_media",aA.media);aw.add("fruit_image",aA.image);aw.add("fruit_recommend_type",aA.type);aw.add("fruit_recommend_position",aA.renderPosition);if(aA.type==="cf"){if(aA.RecallRefer){var ay=aA.RecallRefer;if(Array.isArray(ay)){ay=ay.join("|")}aw.add("recall_refer",ay)}var av=V.identity;if(typeof av==="object"){for(var ax in av){if(av.hasOwnProperty(ax)){aw.add(ax,av[ax])}}}}},previewLog:function(av){av.api="other";av.uniqueId="pv";this._setCommon(av);av.add("domain",location.host)},adInViewLog:function(aw,aA,av){if(aA.reserved){aw.valid=false}aw.api="ad";this._setCommon(aw);aw.add("type","imp");aw.add("time_show_seconds",Math.round((Date.now()-T)/1000));aw.add("nid",aA.nid);aw.add("token",aA.token);aw.add("timestamp",T);aw.add("box_position",av.boxPosition||"");aw.add("channel_id",av.channelId);if(aA.c1){aw.add("c1",aA.c1)}if(aA.c2){aw.add("c2",aA.c2)}if(V.sample_tag){aw.add("sample_tag",V.sample_tag)}aw.add("fruit_userid",aA.userid||"");aw.add("fruit_campaign",aA.campaign||"");aw.add("fruit_title",aA.title||"");aw.add("fruit_domain",aA.domain||"");aw.add("fruit_business_type",aA.business_type||"");aw.add("v_fruit_word",aA.v_fruit_word||"");aw.add("image_hash",aA.image_hash);aw.add("v_dish_labels",V.v_dish_labels||"");aw.add("v_dish_tlabels",V.v_dish_tlabels);aw.add("ad_position",aA.adPosition);aw.add("sample",aA.sample||"");aw.add("classify",aA.classify||"");aw.add("image",aA.image||"");if(typeof aA.clarity!=="undefined"){aw.add("clarity",aA.clarity||"")}if(typeof aA.aesthetic!=="undefined"){aw.add("aesthetic",aA.aesthetic||"")}var az=["smjId","client_id","c1","popin_version","td_global_id","td_version","td_charset","td_language","td_path"];for(var ax=0;ax<az.length;ax++){delete aw.data[az[ax]]}var ay=ar(aA.element);aw.add("fruit_style",ay.articleStyleMonitor&&ay.articleStyleMonitor.getStyleFlag());aw.add("box_style",ay.boxStyleMonitor&&ay.boxStyleMonitor.getStyleFlag())},articleClickLog:function(aw,ay,av,ax){aw.api="discovery";this._setCommon(aw);aw.add("type","click");this._setArticleData(aw,ay)},articleInViewLog:function(av,aw){this.articleCounter=!w(this.articleCounter)?1:this.articleCounter+1;if(this.articleCounter>(k.inrecsysMaxArticleImpLog||3)){av.valid=false}av.api="discovery";this._setCommon(av);av.add("type","imp");this._setArticleData(av,aw)}});I.Performance={isSupported:(window.performance)&&(typeof window.performance.getEntries==="function")&&(typeof window.performance.now==="function"),enableMonitor:true,sample:0.1,isResourceReady:false,db:"fe_performance",table:"base_monitor",id:+(new Date),marks:{},data:{},resourceFilterRules:[function(av,aw){if(/popin.cc\/searchbox\/.+\.js$/.test(aw.name)){av.addMark("request_config_start",aw.startTime);av.set("rcd",parseInt(aw.duration,10));av.addMark("request_config_end",aw.responseEnd);return true}},function(av,aw){if(aw.name.indexOf(aq.apiUrl)===0){av.addMark("request_api_start",aw.startTime);av.set("rad",parseInt(aw.duration,10));av.addMark("request_api_end",aw.responseEnd);return true}}],init:function(){if(!this.isSupported){return}var av=aq;if(typeof av.performanceSample==="number"){this.sample=av.performanceSample}if(typeof av.enablePerformanceMonitor!=="undefined"){this.enableMonitor=av.enablePerformanceMonitor}if(N!==0||Math.random()>this.sample){this.enableMonitor=false}this.addMark("discovery_init",PopIn6.__PERFORMANCE_DISCOVERY_INIT__);if(this.enableMonitor){this.bindEvent()}return this},bindEvent:function(){var av=this;window.addEventListener("load",function(){av.isResourceReady=true;if(av.marks.is_box_rendered){av.report()}},false)},moniteBoxInview:function(){try{var ax=this;var av=[];aq.templates.forEach(function(az){var ay=az.selector;if(av.indexOf(ay)===-1){i(ay,function(){if(!ax.marks.box_in_view){ax.addTimeMark("box_in_view").report()}});av.push(ay)}})}catch(aw){}},addTimeMark:function(av){if(!this.isSupported){return this}if(av==="box_did_render"&&this.marks.box_did_render!==void 0){return this}this.marks[av]=window.performance.now();return this},addMark:function(av,aw){this.marks[av]=aw;return this},set:function(av,aw){this.data[av]=aw;return this},collectResourceInfo:function(){var av=window.performance.getEntries();var aC=this.resourceFilterRules;var aA=aC.length;var aw={};for(var ay=0,az;az=av[ay++];){for(var ax=0,aB;aB=aC[ax];ax++){if(!aB(this,az)){continue}aw[aB.key]=az;aC.splice(ax,1);aA--;break}if(aA===0){break}}},analyse:function(){var av=this.data;var aw=C();av.host=aw.host;av.user_agent=aw.user_agent;av.browser=aw.browser;av.browser_version=aw.browser_version;av.os=aw.os;av.os_version=aw.os_version;av.device=M();av.screen=aw.screen;av.api_host=aq.apiHost;av.media=aq.media;av.libLoadMode="inline";av.rcs=parseInt(this.marks.request_config_start,10);av.di_awr=this.calculate("discovery_init","api_will_request");av.awr_ras=this.calculate("api_will_request","request_api_start");av.rae_adwd=this.calculate("request_api_end","api_data_will_deal");av.adwd_bdr=this.calculate("api_data_will_deal","box_did_render");av.total=this.calculate("request_config_start","box_did_render");av.popin_version=6;av.performance_id=this.id},calculate:function(ax,aw){var av=this.marks;if(typeof av[ax]==="undefined"||typeof av[aw]==="undefined"){return"null"}return parseInt(av[aw]-av[ax],10)},report:function(){if(!this.enableMonitor||!this.isResourceReady||!this.marks.is_box_rendered||this.isReported){return}this.collectResourceInfo();this.analyse();if(this.data.total>0){this.log(this.data)}this.isReported=true;return this},log:function(ay,ax,av){av=av||this.db;ax=ax||this.table;var aw=new window.Treasure2({writeKey:"8378/25839e06ce4cc1cab55c1c1f1e49d336d6d1d48f",database:av});aw.addRecord(ax,ay);return this}};(function(){var av="_popIn_box_position_style_key_";I.Class("PositionAndStyle",{init:function(aw){this.positionAndStyleObj=aw||{};this.channelId=this.positionAndStyleObj.channelId;this.boxPosition=this.positionAndStyleObj.boxPosition||{};this.articleStyleMonitor=this.positionAndStyleObj.articleStyleMonitor||{};this.position="";this.styleMonitor="";this.timer=null;this.timerTimes=0;this.intervalPositionAndStyle()},intervalPositionAndStyle:function(){this.timer=setTimeout(this.setPositionAndStyle.bind(this),500)},setPositionAndStyle:function(){this.timerTimes++;var ax=[];this.position=this.boxPosition.getPosition();this.styleMonitor=this.articleStyleMonitor.getStyleFlag();if(this.position&&this.styleMonitor){if(window.popInPositionAndStyle){var aw=ad.valid?ad.local.get(av):"[]";aw=JSON.parse(aw);aw.push({channelId:this.channelId,boxPosition:this.position,adStyleMonitor:this.styleMonitor});ax=aw}else{ax=[{channelId:this.channelId,boxPosition:this.position,adStyleMonitor:this.styleMonitor}];window.popInPositionAndStyle=true}ad.valid&&ad.local.set(av,JSON.stringify(ax));clearTimeout(this.timer)}else{this.timerTimes<10?this.intervalPositionAndStyle():clearTimeout(this.timer)}}},{getPositionAndStyle:function(){var aw="";var ay="";var ax=ad.valid?ad.local.get(av):"";if(ax){ax=JSON.parse(ax);if(ax&&ax.length>0){aw=ax[0].boxPosition||"";ay=ax[0].adStyleMonitor||""}}return{boxPosition:aw,adStyleMonitor:ay}}})})();I.Class("Template",{init:function(aw){this.setDefaults();for(var av in aw){this[av]=aw[av]}this.selectorStr=this.selector;this.selector=document.querySelector(this.selectorStr);this.isFullClick=this.plugins.some(function(ax){return ax.toLowerCase().indexOf("clickall")>-1||ax.toLowerCase().indexOf("fullclick")>-1})},setDefaults:function(){this.notFoundImg=window.PopIn6.protocol+"//"+aa+"/images/noimg.png";this.imageInView=true;this.adVideoPosition=1;this.adVideoInsertSelector=false;this.adVideoInsertPosition="BeforeEnd";this.addTargetBlank=false;this.isTargetTop=false;this.plugins=[];this.isFullClick=false;this.canInfiniteAds=true;this.includeRules=[];this.excludeRules=[];this.dateFormat="Y.M.D";this.isClickHistory=true;this.hideHistory=false;this.articleNoDisplayPeriod=7;this.aboutPageType=(M()==="mobile")?"newTab":"dialogue"}});(function(){var aB="";var aA="";var aF="__pi_u_id__";var aG=/^([\d\w]{32})|(\d{13})-\d+$/;var ax="https://api.popin.cc";var aM=ax+"/iframe/piuid.html?ac=piuid&t=15888888";var aE=null;var aC=false;I.Class("UserId",{init:function(){try{if("function"===typeof window.postMessage&&!/.+_sdk$/.test(k.pid)){aL()}aA=ay(aF)||"";var aP=ay("_ss_pp_id")||"";if(aG.test(aA)){aB=aA.split("-")[0];return}else{aw(aF)}if(/^([\da-f]{32})|(\d{13})$/.test(aP)){aB=aP;aA=aP+"-"+av();aN(aF,aA);aC=true;return}else{aw("_ss_pp_id")}PopIn6.event.addEventListener("result-loaded",function(aQ){var aR=aQ.cookie;if(aR&&aR.uid&&(!aB||aC)){aB=aR.uid;aA=aB+"-"+av();aN(aF,aA);aC=true}})}catch(aO){aK(aO)}},getUid:function(){if(!aB){aH()}return aB}});function aN(aO,aQ){try{localStorage.setItem(aO,aQ);return true}catch(aP){return false}}function ay(aO){try{return localStorage.getItem(aO)}catch(aP){return""}}function aw(aO){try{return localStorage.removeItem(aO)}catch(aP){return""}}function aL(){aE=A(aM);function aO(aP){try{if(aE.window!==aP.source){return}var aQ=JSON.parse(aP.data);if(aQ.action==="get"){aJ(aQ.payload)}else{if(aQ.action==="done"){window.removeEventListener("message",aO);aE.parentNode&&aE.parentNode.removeChild(aE);aE=null}}}catch(aR){aK(aR)}}window.addEventListener("message",aO,false)}function az(aO){if(!aG.test(aO)){return}aE.window.postMessage(JSON.stringify({action:"setId",payload:aO}),ax)}function aJ(aQ){if("string"!==typeof aQ||!aG.test(aQ)){az(aA);return}if(!aB||aC){aA=aQ;aB=aQ.split("-")[0];aN(aF,aQ);aC=false;return}if(aQ===aA){return}var aP=aQ.split("-");var aO=aA.split("-");if(aO[1]>=aP[1]){aB=aP[0];aN(aF,aQ);if(aP[0]!==aO[0]&&ay(aF)===aQ){aD({previous_id:aO[0],previous_create_time:aO[1],current_id:aP[0],current_create_time:aP[1],host:top.location.host})}return}az(aA)}function aI(aO){var aP=parseInt(Math.floor(Math.random()*Math.pow(16,aO))).toString(16);return(""+Math.pow(10,aO)+aP).slice(-aO)}function aH(){aB=[aI(8),aI(4),aI(4),aI(4),aI(12)].join("");aA=aB+"-"+av();aN(aF,aA);aC=true;return aA}function av(){var aO=new Date;aO.setMinutes(aO.getMinutes()+aO.getTimezoneOffset());return aO.getTime()}function aD(aO){if(window.Treasure2){(new window.Treasure2({writeKey:"8378/25839e06ce4cc1cab55c1c1f1e49d336d6d1d48f",database:"popin_user_id"})).addRecord("uid_change_log",aO)}else{setTimeout(function(){aD(aO)},1000)}}function aK(aO){if(window.Treasure2){(new window.Treasure2({writeKey:"8378/25839e06ce4cc1cab55c1c1f1e49d336d6d1d48f",database:"fe_monitor"})).addRecord("err_log",{msg:aO.message||"",stack:aO.stack||"",name:aO.name||"",ua:navigator.userAgent})}else{setTimeout(function(){aK(aO)},1000)}}})();I.Class("Video",{init:function(av,aw){this.container=av;this.template=aw;this.logs={};if(typeof _popIn_noVideo_loader==="function"){PopIn6.event.addEventListener("no-video",_popIn_noVideo_loader)}if(!ad.valid){return}if(M()!=="mobile"){return}var ax=this.getVideo();if(w(ax)){this.renderVideo(ax)}},getVideo:function(){var aB=[];if(w(aq.adVideo)&&w(V.ad_video)){aB=aB.concat(V.ad_video)}if(w(aq.adReservedVideo)&&w(V.ad_reserved_video)){aB=aB.concat(V.ad_reserved_video)}if(aB.length===0){PopIn6.event.fireEvent("no-video",[])}var aA=ad.session.get("_video")||"";aA=aA.split(".");var az=[];for(var ay=0;ay<aB.length;ay++){var ax=aB[ay];var aw=0;for(var av=0;av<aA.length;av++){if(aA[av]===ax.nid){aw++}}if(aw>1){continue}az.push(ax)}return az.length>0?az[0]:false},createContainer:function(){var av=false;if(typeof window._popIn_video6!=="undefined"){return false}if(w(this.template.adVideoInsertSelector)){av=document.body.querySelectorAll(this.template.adVideoInsertSelector)}else{av=this.container.querySelectorAll("._popIn_infinite_page")}if(av.length>0&&this.template.adVideoPosition-1<av.length){return av[this.template.adVideoPosition-1]}return false},renderVideo:function(ax){var aw=this.createContainer();if(!w(aw)){return}var av=W(document.createDocumentFragment(),"div","_popIn_infinite_video");var aB=this.template.adVideoInsertPosition.toLowerCase();if(aB==="beforebegin"){aw.parentNode.insertBefore(av,aw)}if(aB==="afterbegin"){aw.insertBefore(av,aw.firstChild)}if(aB==="beforeend"){aw.appendChild(av)}if(aB==="afterend"){aw.parentNode.insertBefore(av,aw.nextSibling)}var aD=ac(aq.apiUrl);var aE=[["discoveryplus.popin.cc","jp"],["jp.popin.cc","jp"],["tw.popin.cc","tw"],["kr.popin.cc","kr"],["popin.cc","jp"]];var aA="jp";for(var aC=0,az=aE.length;aC<az;aC++){var ay=aE[aC];if(aD.host.indexOf(ay[0])>-1){aA=ay[1];break}}window._popIn_video6={container:av,data:ax,logger:this,country:aA};var aF=document.createElement("script");aF.type="text/javascript";aF.charset="UTF-8";aF.async=true;aF.src=window.PopIn6.protocol+"//"+aa+"/popin_video6_ads-min.js";var aG=document.getElementsByTagName("script")[0];aG.parentNode.insertBefore(aF,aG);return},log:function(ay){var aG=ay.type;var aB=aG+(w(ay.value)?"_"+ay.value:"");if(!w(this.logs[aB])){this.logs[aB]=1}else{this.logs[aB]++}var aw=this.logs[aB];ay.counter=aw;var aD=ay.video;var aI=(w(aD.type)&&aD.type==="vast")?true:false;if(aG==="second"&&aw>1){return}if(aG==="percent"&&aw>1){return}if(aG==="inview"&&aD.tracking_pixel&&aw===1){u(aD.tracking_pixel)}var aH=w(aD.video.background)||(w(aD.video.type)&&aD.video.type==="vertical");var aA=aq.apiHost;function av(aJ){aJ.forEach(function(aK){aC(aK,true)})}function aC(aJ,aK){new Image().src=aJ+(w(aK)?"":"&t="+Date.now())}function az(aJ){I.Log.videoLog(ay,aJ)}if(aB==="full"&&aI&&w(aD.ClickTracking)&&aw===1){av(aD.ClickTracking)}if(aB==="second_1"){}if(w(aD.video.play_time_seconds)&&aB==="second_"+aD.video.play_time_seconds){var aF=aD.url;aF+=((aF.indexOf("?")>0?"&":"?")+"type="+(aH?"vertical_":"")+"imp&api_host="+aA);aC(aF+"&target=c");if(aI&&w(aD.Impression)){av(aD.Impression)}az("playTimeSeconds")}if(aB==="percent_100"){var aE=aD.url;aE+=((aE.indexOf("?")>0?"&":"?")+"type=end&api_host="+aA);aC(aE);if(aI&&w(aD.complete)){av(aD.complete)}}if(aB==="second_2"){this.saveHistory(ay);var ax=aD.url;ax+=((ax.indexOf("?")>0?"&":"?")+"type="+(aH?"vertical_":"")+"imp&api_host="+aA);aC(ax+(w(aD.video.play_time_seconds)?"&target=m":""));az("imp");I.Log.videoMediaDnaLog(ay,aG);if(aI&&w(aD.start)){av(aD.start)}return az("2s")}if(aB==="second_3"){return az("3s")}if(aG==="percent"){if(ay.value%25===0||ay.value===95){if(aI){switch(ay.value){case 25:av(aD.firstQuartile);break;case 50:av(aD.midpoint);break;case 75:av(aD.thirdQuartile);break;default:break}}return az(""+ay.value)}}if(aG==="share"){return az("share_"+ay.value)}if(!w(ay.value)){return az(aG)}},saveHistory:function(aw){var av=ad.session.get("_video");if(w(av)){av+=("."+aw.video.nid)}else{av=aw.video.nid}ad.session.set("_video",av)}});var N=0;N+=(location.href.indexOf("popintest=true")>-1?1:0);N+=(location.href.indexOf("popinadtest=true")>-1?1:0);N+=(location.href.indexOf("popinadid=")>-1?1:0);N+=(location.href.indexOf("popinadimage=")>-1?1:0);N+=(location.href.indexOf("popinvideotest=")>-1?1:0);E._testMode=N;var U="__smjidfa__";if(ad.valid){PopIn6.smjId=ad.local.get(U)}var T=Date.now();var S=new I.UserId();var aq=new I.Config();var V={};E._selectedArticles=aj;E._userId=S;E._config=aq;E._start=T;window.PopIn=window.PopIn||{};window.PopIn.init=function(av){av=av||{};S=new I.UserId();aj=[];aq=new I.Config(av);V={};T=Date.now();new I.Loader()};var B="";if(ad.valid){B=ad.local.get("_ss_pp_id")||""}var O=function(){var az=[["news.google.co","portal_google"],["search.yahoo.co","search_yahoo"],["facebook.co","sns_facebook"],["twitter.co","sns_twitter"],["t.co$","sns_twitter"],["yahoo.co","portal_yahoo"],["goo.ne","portal_goo"],["infoseek.co","portal_infoseek"],["msn.com","portal_msn"],["excite.co.jp","portal_excite"],["livedoor.com","portal_livedoor"],["search.naver.com","search_naver"],["naver.com|naver.jp","sns_naver"],["hatena.ne.jp","sns_hatena"],["aol.jp","portal_aol"],["google.co","search_google"],["www.bing.com","search_bing"],["www.biglobe.ne.jp","portal_biglobe"],["www.smartnews.be|www.smartnews.com","app_smartnews"],["gunosy.com","app_gunosy"],["newspicks.com","app_newspicks"],["antenna.jp","app_antenna"],["paid.outbrain.com","paid_outbrain"],["trc.taboola.com","paid_yahoo"],["dsp.logly.co.jp","paid_logly"]];az.push([location.host,"site"]);var ax="other";var ay=ac(document.referrer).host;for(var aw=0,aA=az.length;aw<aA;aw++){var av=az[aw];if(RegExp(av[0]).test(ay)){ax=av[1];break}}if(document.referrer===""){ax="organic"}if(location.href.indexOf("utm_medium=logly")>-1){ax="paid_logly"}return ax};var x=O();I.Performance.init();PopIn6.event.fireEvent("after-init",[]);new I.Loader()}catch(ap){window.PopIn6.handleError(ap)}})();var b=function(){var s=0;var i=false;var w=function(y){s++;i=y};window.addEventListener("touchstart",w,false);window.addEventListener("click",w,false);window.addEventListener("mousedown",w,false);var u={};function v(y){if(y.valid===false){return false}if(y.uniqueId){var z=y.type+"|"+y.uniqueId;if(y.type==="treasure"&&y.typeIndex===6&&y.uniqueId==="imp"){z=y.type+"|"+y.uniqueId+"|"+y.channelId}if(u[z]){return false}u[z]=1}return true}var x={};x.Class=function(z,y){this[z]=function(){if(this.init){this.init.apply(this,arguments)}};y.type=z.toLowerCase();this[z].prototype=y};x.Class("Basic",{init:function(){this.data=[];this.mode="normal"},add:function(y,z){this.data.push(y+"="+z)},imageLog:function(z){var y=new Image();if(this.onComplete){y.onload=this.onComplete}if(this.onError){y.onerror=this.onError}y.src=z},execute:function(){this.add("t",Date.now());var y=window.PopIn6.protocol;if(v(this)){switch(this.mode){case"normal":this.imageLog(y+"//rlog.popin.cc/s.gif?"+this.data.join("&"));break;case"other":this.imageLog(y+"//r.popin.cc/log.gif?"+this.data.join("&"));break}}}});x.Class("Treasure",{init:function(){this.data={}},add:function(y,z){this.data[y]=z},imageLog:function(z){var y=new Image();if(this.onComplete){y.onload=this.onComplete}if(this.onError){y.onerror=this.onError}y.src=z},getTrackValues:function(){return PopIn6._logger.trackValues||{}},execute:function(){this.data.interaction_number=s;if(i){if(i.touches){var z=i.touches[0];this.data.interaction_touchx=Math.round(z.pageX);this.data.interaction_touchy=Math.round(z.pageY)}if(i.type==="mousedown"){this.data.interaction_mousex=Math.round(i.pageX);this.data.interaction_mousey=Math.round(i.pageY)}}var y=this;this.add("popin_version",6);if(v(this)){if(this.db==="popin_media"&&this.table==="discoverylogs"){this.sendToUts();return this}this.sendToTd();if(this.db==="popin_ads"&&this.table==="adlogs"){this.sendToUts()}return this}},sendToTd:function(){var z=new Treasure2({writeKey:"8378/25839e06ce4cc1cab55c1c1f1e49d336d6d1d48f",database:this.db});z.set("$global","td_global_id","td_global_id");var y=this;z.addRecord(this.table,this.data,function(){if(y.onComplete){y.onComplete()}},function(){if(y.onError){y.onError()}})},sendToUts:function(){var y=this._uainfo;this.data.td_os=y.os;this.data.td_os_version=y.os_version;this.data.td_browser=y.browser;this.data.td_browser_version=y.browser_version;delete this.data.td_ip;var z=JSON.stringify(this.data);this.imageLog([window.PopIn6.protocol+"//log.popin.cc/log","/"+this.db,"/"+this.table,"?data="+btoa(unescape(encodeURIComponent(z)))].join(""))}});x.Class("Inrecsys",{init:function(){this.data={}},getTrackValues:function(){return PopIn6._logger.trackValues||{}},add:function(y,z){this.data[y]=z},imageLog:function(z){var y=new Image();if(this.onComplete){y.onload=this.onComplete}if(this.onError){y.onerror=this.onError}y.src=z},execute:function(){this.add("popin_version",6);var y=JSON.stringify(this.data);var z=btoa(unescape(encodeURIComponent(y)));if(v(this)){this.imageLog(window.PopIn6.protocol+"//inrecsys.popin.cc/PopinService/Logs/"+this.api+"?data="+z)}}});PopIn6.log=function(y){y(new x.Basic());y(new x.Treasure());y(new x.Inrecsys())};if(PopIn6._tempLog){while(PopIn6._tempLog.length>0){PopIn6.log(PopIn6._tempLog.shift())}}};b();var d=function(u){var s=[];s.push("all-test");var w=PopIn5.$F.isMobileDevice()?"mobile":"pc";if(location.href.indexOf("popintest=true")>0){s.push(w+"-test")}s.push(w);s.push("all");for(var v=0;v<s.length;v++){var x=s[v];if(PopIn5.$F.notEmpty(q[x])&&PopIn5.$F.notEmpty(q[x][u])){return q[x][u]}}return false};if(typeof _popIn5_config["*"]==="undefined"){_popIn5_config["*"]=k}if(typeof _popIn5_config.Discovery==="undefined"){_popIn5_config.Discovery=function(){return false}}if(typeof _popIn5_config.Read==="undefined"){_popIn5_config.Read=function(){return d("Read")}}var a=false;var e=document.getElementsByTagName("script");for(var f=0,c=e.length;f<c;f++){var g=e[f];if(g.src.indexOf("popin_discovery5-min.js")>-1){a=true}}if(!a){var n=document.createElement("script"),l=window.PopIn6;n.type="text/javascript";n.charset="utf-8";n.async=true;n.src=l.protocol+"//"+l.domain+"/popin_discovery5-min.js";var r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(n,r)}return}var d=function(u){var s=[];s.push("all-test");var w=PopIn5.$F.isMobileDevice()?"mobile":"pc";if(location.href.indexOf("popintest=true")>0){s.push(w+"-test")}s.push(w);s.push("all");for(var v=0;v<s.length;v++){var x=s[v];if(PopIn5.$F.notEmpty(q[x])&&PopIn5.$F.notEmpty(q[x][u])){return q[x][u]}}return false};if(typeof _popIn5_config["*"]==="undefined"){_popIn5_config["*"]=k}if(typeof _popIn5_config.Discovery==="undefined"){_popIn5_config.Discovery=function(){return d("Discovery")}}if(typeof _popIn5_config.Read==="undefined"){_popIn5_config.Read=function(){return d("Read")}}var n=document.createElement("script");n.type="text/javascript";n.charset="utf-8";n.async=true;n.src=window.location.protocol+"//api.popin.cc/popin_discovery5-min.js";var r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(n,r)})();